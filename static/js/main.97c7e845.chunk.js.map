{"version":3,"sources":["URL.js","PangenomeSchematic.js","ComponentConnectorRect.js","SpanCell.js","utilities.js","ComponentRect.js","ComponentNucleotides.js","LinkColumn.js","LinkArrow.js","LinkRecord.js","App.js","NucleotideTooltip.js","ControlHeader.js","serviceWorker.js","ViewportInputsStore.js","index.js"],"names":["urlExists","dataName","http","XMLHttpRequest","open","send","status","theUrl","callback","a","xmlHttp","onreadystatechange","readyState","responseText","PangenomeSchematic","props","pathNames","components","jsonCache","nucleotides","metadata","loadIndexFile","store","jsonName","loadMetadataFile","observe","chunkFastaURLs","loadFasta","jsonFilename","console","log","indexPath","process","fetch","then","res","json","setChunkIndex","filepath","Error","url","data","json_version","MediaError","this","path_names","processArray","path_fasta","response","text","sequence","replace","substr","push","addChunkProcessedFasta","mdataPath","metaData","i","length","metaDataKey","setMetaData","chunksProcessed","chunkURLs","urlIndex","jsonChunk","num_components_already_loaded","index","entries","component","first_bin","componentItem","Component","addChunkProcessed","slice","React","columnX","x","compressedColumnX","compressedX","firstBin","lastBin","last_bin","arrivals","arrival","LinkColumn","departures","departure","relativePixelX","occupants","matrix","num_bin","useWidthCompression","linkColumn","upstream","downstream","participants","key","edgeToKey","String","padStart","ConnectorRect","state","color","y","width","height","fill","MatrixCell","event","relColumnX","Math","floor","max","evt","layerX","pixelsPerColumn","item","range","min","tooltipContent","pathName","startsWith","ranges","j","start","end","new_content","undefined","get","Info","updateCellTooltipContent","inverted","pixelsPerRow","align","verticalAlign","onMouseOver","onHover","bind","onMouseLeave","onLeave","copyNumber","copyNumberColorArray","invertedColorArray","onMouseMove","inversionText","SpanCell","row","iColumns","prev","spans","newSpan","column","map","span","rowNumber","sum","b","arraysEqual","A","B","every","e","indexOf","checkAndForceMinOrMaxValue","value","minValue","maxValue","isInt","isNaN","parseFloat","stringToColorAndOpacity","highlightedLinkColumn","selectedLink","whichLinkToConsider","colorKey","matchColor","stringToColourSave","toString","hash","charCodeAt","colour","getMax","arr","len","Infinity","ComponentRect","handleClick","setState","parts","entry","vertical_rank","row_n","renderMatrixRow","updateMaxHeight","verticalRank","uncompressed_y","this_y","useVerticalCompression","compressed_row_mapping","hasOwnProperty","rowColor","colorByGeneAnnotation","Color","colorFromStr","parent","topOffset","connectorsColumn","yOffset","reduce","uncompressed_row","renderComponentConnector","uncompressedRow","x_val","binScalingFactor","widthInColumns","onClick","renderMatrix","useConnector","renderAllConnectors","ComponentNucleotides","listOfObjects","fontSize","handleMouseOut","handleMouseOver","updateHighlightedNode","Array","keys","v","pathIndex","contents","linkCells","y_coord","d","opacity","stroke","onMouseOut","isInfinity","n","Number","isFinite","LinkArrow","link","updateSelectedLink","arrowXCoord","points","xArrival","departureX","xDepart","arrX","turnDirection","departOrigin","departCorner","elevation","departTop","arriveTop","arriveCorner","arriveCornerEnd","abs","isArrival","some","calculatePoints","bezier","strokeWidth","stroke-opacity","pointerLength","pointerWidth","tension","LinkRecord","xCoordArrival","xCoordDeparture","calculateLinkCoordinates","schematic","leftXStart","index_to_component_to_visualize_dict","linkToXMapping","schematizeComponent","paddedKey","k","linkToXmapping","distanceSortedLinks","Object","values","sort","distance","elevationOccupied","record","linkBegin","linkEnd","reserveElevationAirSpace","top","calculateLinkElevations","NucleotideTooltip","MouseTooltip","visible","offsetX","offsetY","style","background","zIndex","cellToolTipContent","ControlHeader","percentage","beginBin","getBeginBin","endBin","getEndBin","size","diff","updateBeginEndBin","pathNucPos","path","nucPos","httpGetAsync","pathIndexServerAddress","result","alert","parseInt","newBeginBin","ceil","getBinWidth","target","options","selectedIndex","setIndexSelectedZoomLevel","indexSelZoomLevel","indexSelectedZoomLevel","availableZoomLevels","className","type","list","placeholder","onChange","updatePathNucPos","id","marginLeft","handleJump","defaultValue","tryJSONpath","title","decIndexSelectedZoomLevel","val","change_zoom_level","incIndexSelectedZoomLevel","shift","beginEndBin","readOnly","name","last_bin_pangenome","Fragment","updateHeight","updateWidth","href","rel","VerticalCompressedViewSwitch","checked","toggleUseVerticalCompression","RenderConnectorSwitch","toggleUseConnector","WidthCompressedViewSwitch","toggleUseWidthCompression","Legend","src","alt","position","bottom","left","App","layerRef","createRef","layerRef2","layerNavigationBar","timerHighlightingLink","timerSelectionLink","componentDidMount","clientHeight","document","getElementById","getElementsByClassName","buttonsHeight","current","getCanvas","_canvas","linkRect","clearTimeout","highlightedLink","setTimeout","_updateHighlightedNode","update_state","binLeft","binRight","last_bin_last_visualized_component","end_closer","newEndBin","screenWidth","half","renderNucleotidesSchematic","loading","nt_shift","nucleotides_slice","currentTarget","attrs","handleMouseMove","schematize","actualWidth","fetchAllChunks","updateSchematicMetadata","openRelevantChunksFromIndex","recalcXLayout","recalcY","chunksProcessedFasta","render","firstFieldX","fieldX","getColumnX","_column_shift","chunkIndex","zoom_levels","setAvailableZoomLevels","window","innerWidth","selZoomLev","getSelectedZoomLevel","chunkURLarray","fileArrayFasta","level","ichunk","files","chunk","fasta","calculateEndBinFromScreen","fileArray","setLastBinPangenome","scaling_factor","round","prepareWhichComponentsToVisualize","URLprefix","filename","switchChunkFastaURLs","switchChunkURLs","chunkPath","jsonFetch","loadJsonCache","warn","annotationNames","all_visible","Set","c","add","row_mapping","ordered_num_rows","all_annotation_num_rows","annotationName","row_mapping_high","row_mapping_individuals","num_row_ref","num_row","has","concat","from","count","compress_visible_rows","maxNumRowsAcrossComponents","calcMaxNumRowsAcrossComponents","setLoading","first_visualized_component","last_visualized_component","links","updateTopOffset","lengths","firstDepartureColumn","visibleHeightPixels","renderLinkColumn","leftPad","localColor","localOpacity","localStroke","renderComponent","renderLink","navigation_bar_width","x_navigation","width_navigation","minWidth","leftOffset","cursor","heightNavigationBar","ref","renderSortedLinks","loadingMessage","renderSchematic","Boolean","location","hostname","match","Chunk","types","model","file","string","maybeNull","integer","ZoomLevel","bin_width","array","ChunkIndex","pangenome_length","PathNucPos","metaDataModelEntry","Path","identifier","optional","maximumHeightThisFrame","precIndexSelectedZoomLevel","actions","self","newBegin","newEnd","newTopOffset","isSafeInteger","updateHighlightedLink","latestHeight","resetRenderStats","newContents","updateBinScalingFactor","newFactor","arrayOfFile","singleChunk","singleChunkFasta","get_prec_zoom_level","set","getMetaData","setMetaDataChoices","ar","metaDataChoices","views","create","ReactDOM","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.97c7e845.chunk.js","sourcesContent":["/// a collection of functions to deal with URL requests\n\nexport function urlExists(dataName) {\n  if (dataName === \"\") {\n    return false;\n  } else {\n    //source: https://stackoverflow.com/a/22011478/3067894\n    var http = new XMLHttpRequest();\n      http.open(\"HEAD\", dataName, false);\n    http.send();\n    return http.status !== 404;\n  }\n}\n\nexport async function httpGetAsync(theUrl, callback) {\n  var xmlHttp = new XMLHttpRequest();\n  xmlHttp.onreadystatechange = function () {\n    if (xmlHttp.readyState === 4 && xmlHttp.status === 200)\n      callback(xmlHttp.responseText);\n  };\n  await xmlHttp.open(\"GET\", theUrl, true); // true for asynchronous\n  xmlHttp.send(null);\n}\n","import React from \"react\";\nimport { observe } from \"mobx\";\nimport { urlExists } from \"./URL\";\n\nclass PangenomeSchematic extends React.Component {\n  constructor(props) {\n    /*Only plain objects will be made observable. For non-plain objects it is considered the\n\t\t responsibility of the constructor to initialize the observable properties. Either use\n\t\t the @observable annotation or the extendObservable function.*/\n\n    super(props);\n    this.pathNames = [];\n    this.components = [];\n    this.jsonCache = {}; // URL keys, values are entire JSON file datas\n    // TODO: make jsonCache store React components and save them in mobx\n    // TODO: make FILO queue to remove old jsonCache once we hit max memory usage\n    this.nucleotides = []; // nucleotides attribute and its edges\n\n    this.metadata = [];\n\n    this.loadIndexFile(this.props.store.jsonName); //initializes this.chunkIndex\n    this.loadMetadataFile(this.props.store.jsonName);\n\n    //STEP #1: whenever jsonName changes, loadIndexFile\n    observe(this.props.store, \"jsonName\", () => {\n      this.loadIndexFile(this.props.store.jsonName);\n      this.loadMetadataFile(this.props.store.jsonName);\n    });\n\n    // The FASTA files are read only when there are new chunks to read\n    observe(this.props.store.chunkFastaURLs, () => {\n      this.loadFasta();\n    });\n\n    //STEP #7: JsonCache causes processArray to update chunksProcessed\n    // observe(this.props.store.jsonCache,\n    //     this.processArray.bind(this));\n\n    // console.log(\"public \", process.env.PUBLIC_URL ) //PUBLIC_URL is empty\n  }\n  componentDidUpdate() {\n    // console.log(\"#components: \" + this.components);\n  }\n\n  loadIndexFile(jsonFilename) {\n    console.log(\"STEP #1: whenever jsonName changes, loadIndexFile\");\n\n    let indexPath =\n      process.env.REACT_APP_FETCH + jsonFilename + \"/bin2file.json\";\n    //console.log(\"loadIndexFile - START reading\", indexPath);\n\n    return fetch(indexPath)\n      .then((res) => res.json())\n      .then((json) => {\n        console.log(\"loadIndexFile - END reading\", indexPath);\n\n        //STEP #2: chunkIndex contents loaded\n        this.props.store.setChunkIndex(json);\n      });\n  }\n\n  jsonFetch(filepath) {\n    if (!filepath)\n      throw new Error(\n        \"No filepath given. Ensure chunknames in bin2file.json are correct.\"\n      );\n    console.log(\"Fetching\", filepath);\n    return fetch(filepath).then((res) => res.json());\n  }\n\n  loadJsonCache(url, data) {\n    console.log(\"STEP #6: fetched chunks go into loadJsonCache\");\n\n    if (data.json_version !== 17) {\n      throw MediaError(\n        \"Wrong Data JSON version: was expecting version 17, got \" +\n        data.json_version +\n        \".  \" +\n        \"This version added x and compressedX fields for the chunks too.  \" + // KEEP THIS UP TO DATE!\n          \"Using a mismatched data file and renderer will cause unpredictable behavior,\" +\n          \" instead generate a new data file using github.com/graph-genome/component_segmentation.\"\n      );\n    }\n    this.jsonCache[url] = data;\n    this.pathNames = data.path_names; //TODO: in later JSON versions path_names gets moved to bin2file.json\n    //console.log(this.pathNames.length, \" path names loaded\");\n    this.processArray();\n  }\n\n  loadFasta() {\n    console.log(\"loadFasta\");\n\n    // Clear the nucleotides information\n    this.nucleotides = [];\n\n    // This loop will automatically cap out at the fasta file corrisponding to the last loaded chunk\n    for (let path_fasta of this.props.store.chunkFastaURLs) {\n      if (urlExists(path_fasta)) {\n        //console.log(\"loadFasta - START: \", path_fasta);\n\n        fetch(path_fasta)\n          .then((response) => {\n            return response.text();\n          })\n          .then((text) => {\n            const sequence = text\n              .replace(/.*/, \"\")\n              .substr(1)\n              .replace(/[\\r\\n]+/gm, \"\");\n\n            //split into array of nucleotides\n            this.nucleotides.push(...sequence);\n\n            //console.log(\"loadFasta - END: \", path_fasta);\n            this.props.store.addChunkProcessedFasta(path_fasta);\n          });\n      }\n    }\n  }\n\n  loadMetadataFile(jsonFilename) {\n    const mdataPath =\n      process.env.REACT_APP_FETCH + jsonFilename + \"/metadata.json\";\n    console.log(\"loadMetadataFile: \", mdataPath);\n\n    if (urlExists(mdataPath)) {\n      console.log(\"Reading metadata\");\n      return fetch(mdataPath)\n        .then((res) => res.json())\n        .then((json) => {\n          var metaData = {};\n          // commented-out could be used further to read in the metadata categories\n          // into json_entries array.\n          //let json_entries = [];\n          for (let i = 0; i < json.length; i++) {\n            metaData[json[i][this.props.store.metaDataKey]] = json[i];\n            // if (i == 0) {\n            //   for (let [key, value] of Object.entries(json[0])) {\n            //     json_entries.push(key);\n            //   }\n            //   this.props.store.setMetaDataChoices(json_entries);\n            // }\n          }\n          this.props.store.setMetaData(metaData);\n        });\n    }\n  }\n\n  /**Parses beginBin to endBin range, returns false if new file needed.\n   * This calculates the pre-render for all contiguous JSON data.\n   * State information is stored in store.chunksProcessed.\n   * Checks if there's new available data to pre-render in processArray()\n   * run through list of urls in order and see if we have data to load.**/\n  processArray() {\n    //TODO: make processArray parallelized by placing outputs in a Key Map and rendering out of order\n    console.log(\n      \"STEP #7: JsonCache causes processArray to update chunksProcessed\"\n    );\n    const store = this.props.store;\n\n    if (\n      store.chunksProcessed.length === 0 ||\n      store.chunksProcessed[0] !== store.chunkURLs[0]\n    ) {\n      this.components = []; // clear all pre-render data\n    }\n\n    // may have additional chunks to pre-render\n    //console.log(\"processArray - parsing components \", store.getBeginBin(), \" - \", store.getEndBin());\n\n    for (let urlIndex = 0; urlIndex < store.chunkURLs.length; urlIndex++) {\n      //if end of pre-render is earlier than end of contiguous available chunks, process new data\n      if (urlIndex >= store.chunksProcessed.length) {\n        //only process if data is available\n        if (store.chunkURLs[urlIndex] in this.jsonCache) {\n          let url = store.chunkURLs[urlIndex];\n          let jsonChunk = this.jsonCache[url];\n\n          // At the moment, the index is used as a rank of the component, then it has to be progressive between chunks\n          const num_components_already_loaded =\n            this.components.length > 0\n              ? this.components[this.components.length - 1].index + 1\n              : 0;\n          for (const [index, component] of jsonChunk.components.entries()) {\n            if (component.first_bin > 0) {\n              let componentItem = new Component(\n                component,\n                num_components_already_loaded + index\n              );\n              this.components.push(componentItem); //TODO: concurrent modification?\n              //if (component.last_bin >= beginBin) { NOTE: we are now reading in whole chunk, this may place\n              //xOffset further right than it was intended when beginBin > chunk.first_bin\n            }\n          }\n          store.addChunkProcessed(url);\n        } else {\n          //we've run into a contiguous chunk that is not available yet\n          return false;\n        }\n      }\n    }\n\n    console.log(\n      \"processArray\",\n      store.chunksProcessed[0],\n      store.chunksProcessed.slice(-1)[0],\n      \"out of\",\n      this.props.store.chunkURLs.length,\n      \"chunks\"\n    );\n    //console.log(this.props)\n\n    return true; //store.chunksProcessed.length > 0;\n  }\n}\n\nclass Component {\n  //extends React.Component{\n  constructor(component, index) {\n    this.columnX = component.x;\n    this.compressedColumnX = component.compressedX;\n\n    this.index = index;\n    this.firstBin = component.first_bin;\n    this.lastBin = component.last_bin;\n\n    this.arrivals = [];\n    for (let arrival of component.arrivals) {\n      this.arrivals.push(new LinkColumn(arrival));\n    }\n    this.departures = [];\n    for (let departure of component.departures) {\n      //don't slice off adjacent here\n      this.departures.push(new LinkColumn(departure));\n    }\n\n    this.relativePixelX = -1;\n\n    // deep copy of occupants\n    this.occupants = component.occupants; //Array.from(\n    this.matrix = component.matrix; // Array.from(\n    this.num_bin = this.lastBin - this.firstBin + 1;\n  }\n\n  getColumnX(useWidthCompression) {\n    return useWidthCompression ? this.compressedColumnX : this.columnX;\n  }\n}\n\nclass LinkColumn {\n  constructor(linkColumn) {\n    this.upstream = linkColumn.upstream;\n    this.downstream = linkColumn.downstream;\n    this.participants = linkColumn.participants; //new Set\n    this.key = this.edgeToKey();\n  }\n  edgeToKey() {\n    /**downstream and upstream are always in the same orientation regardless of if it is a\n     * departing LinkColumn or an arriving LinkColumn.**/\n    return (\n      String(this.downstream).padStart(13, \"0\") +\n      String(this.upstream).padStart(13, \"0\")\n    );\n  }\n}\n\nexport default PangenomeSchematic;\n","import React from \"react\";\nimport {Rect} from \"react-konva\";\nimport PropTypes from \"prop-types\";\n\nexport class ConnectorRect extends React.Component {\n  state = {\n    color: this.props.color,\n  };\n\n  render() {\n    return (\n      <Rect\n        x={this.props.x}\n        y={this.props.y}\n        width={this.props.width}\n        height={this.props.height || 1}\n        fill={this.state.color}\n      />\n    );\n  }\n}\n\nConnectorRect.propTypes = {\n  x: PropTypes.number,\n  y: PropTypes.number,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  store: PropTypes.node,\n  color: PropTypes.node,\n};\n","import React from \"react\";\nimport { Rect, Text } from \"react-konva\";\nimport PropTypes from \"prop-types\";\n\nexport class MatrixCell extends React.Component {\n  onHover(event) {\n    //tooltip: this.props.item.mean_pos\n\n    // An example: Path_name, Coverage: 0.23, Inversion: 0.0, Pos: 2365-27289\n\n    //TODO: calculate relative X and select item from this.props.range\n    let relColumnX = Math.floor(\n      Math.max(0, event.evt.layerX - this.props.x) /\n        this.props.store.pixelsPerColumn\n    );\n    //console.log(event, this.props.range, relColumnX);\n\n    let item = this.props.range[\n      Math.min(this.props.range.length - 1, relColumnX)\n    ];\n    let pathName = this.props.pathName.startsWith(\"NC_045512\")\n      ? \"Reference: \" + this.props.pathName\n      : this.props.pathName;\n    let tooltipContent = '\"';\n    tooltipContent +=\n      pathName +\n      '\"\\nCoverage: ' +\n      item[0] +\n      \"\\nInversion: \" +\n      item[1] +\n      \"\\nPos: \";\n\n    const ranges = item[2];\n    for (let j = 0; j < ranges.length; j++) {\n      const start = ranges[j][0];\n      const end = ranges[j][1];\n      let new_content = \"\";\n\n      if (start === 0) {\n        new_content = end + \"+\";\n      } else if (end === 0) {\n        new_content = start + \"-\";\n      } else {\n        new_content = start + \"-\" + end;\n      }\n\n      if (j > 0) {\n        new_content = \",\" + new_content;\n      }\n\n      tooltipContent += new_content;\n    }\n\n    if (this.props.store.metaData.get(this.props.pathName) !== undefined) {\n      tooltipContent +=\n        \"\\n\" + this.props.store.metaData.get(this.props.pathName).Info;\n    }\n\n    this.props.store.updateCellTooltipContent(tooltipContent); //item[2] is array of ranges\n  }\n\n  onLeave() {\n    this.props.store.updateCellTooltipContent(\"\"); // we don't want any tooltip displayed if we leave the cell\n  }\n\n  /**Reduced number of Text elements generated for inversions,\n   * mouse events restored**/\n  inversionText(inverted) {\n    if (this.props.store.pixelsPerRow > 9 && inverted) {\n      return (\n        <Text\n          x={this.props.x}\n          y={this.props.y}\n          width={this.props.width}\n          height={this.props.height || 1}\n          align={\"center\"}\n          verticalAlign={\"center\"}\n          text={inverted ? \"<\" : \" \"}\n          onMouseOver={this.onHover.bind(this)}\n          onMouseLeave={this.onLeave.bind(this)}\n        />\n      );\n    } else {\n      return null;\n    }\n  }\n\n  render() {\n    if (this.props.range === undefined || this.props.range.length === 0) {\n      return null; //giving up\n    }\n    const inverted = this.props.range[0][1] > 0.5;\n    const copyNumber = this.props.range[0][0];\n\n    let color = this.props.color;\n\n    if (copyNumber > 1 && !inverted) {\n      // 11 items is number of colors in copyNumberColorArray\n      if (copyNumber < 10) {\n        color = this.props.store.copyNumberColorArray[copyNumber];\n      } else {\n        color = this.props.store.copyNumberColorArray[10];\n      }\n    }\n\n    if (inverted) {\n      // 11 items is number of colors in invertedColorArray\n      if (copyNumber < 10) {\n        color = this.props.store.invertedColorArray[copyNumber];\n      } else {\n        color = this.props.store.invertedColorArray[10];\n      }\n    }\n\n    // TODO: if possible, use HTML/CSS to write the '<', avoiding the <Text />s rendering, therefore improving the performance\n    return (\n      <>\n        <Rect\n          x={this.props.x}\n          y={this.props.y}\n          width={this.props.width}\n          height={this.props.height || 1}\n          fill={color}\n          onMouseMove={this.onHover.bind(this)}\n          onMouseLeave={this.onLeave.bind(this)}\n        />\n        {this.inversionText(inverted)}\n      </>\n    );\n  }\n}\n\nMatrixCell.propTypes = {\n  store: PropTypes.object,\n  range: PropTypes.object,\n  x: PropTypes.number,\n  y: PropTypes.number,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  color: PropTypes.node,\n  pathName: PropTypes.node,\n};\n\nexport class SpanCell extends React.Component {\n  constructor(props) {\n    super(props);\n    this.width = props.row.length;\n    //https://github.com/graph-genome/Schematize/issues/87\n    //Sparse matrix includes the relative columns for each bin inside a component\n    //Columns are not necessarily contiguous, but follow the same order as `row`\n  }\n\n  render() {\n    if (!this.props.row.length || !this.props.iColumns.length) {\n      return null;\n    }\n    let prev = this.props.iColumns[0] - 1;\n    let spans = [];\n    let newSpan = { width: 0, x: this.props.iColumns[0], range: [] };\n    for (let i = 0; i < this.props.iColumns.length; i++) {\n      let column = this.props.iColumns[i];\n      if (column === prev + 1) {\n        //contiguous\n        newSpan.width += 1;\n        newSpan.range.push(this.props.row[i]);\n      } else {\n        //non-contiguous\n        spans.push(newSpan);\n        //create new newSpan\n        newSpan = { width: 1, x: column, range: [this.props.row[i]] };\n      }\n      prev = column;\n    }\n    spans.push(newSpan);\n    return (\n      <>\n        {spans.map((span) => (\n          <MatrixCell\n            key={\"span\" + this.props.rowNumber + \",\" + span.x}\n            range={span.range}\n            store={this.props.store}\n            pathName={this.props.pathName}\n            color={this.props.color}\n            x={this.props.x + span.x * this.props.store.pixelsPerColumn}\n            y={this.props.y}\n            rowNumber={this.props.rowNumber}\n            width={span.width * this.props.store.pixelsPerColumn}\n            height={this.props.store.pixelsPerRow}\n          />\n        ))}\n      </>\n    );\n  }\n}\n\nMatrixCell.propTypes = {\n  row: PropTypes.node,\n  iColumns: PropTypes.node,\n  parent: PropTypes.object,\n  store: PropTypes.object,\n  pathName: PropTypes.node,\n  y: PropTypes.number,\n  rowNumber: PropTypes.number,\n  verticalRank: PropTypes.number,\n};\n","export const zip = (arr, ...arrs) => {\n  /*Credit: https://gist.github.com/renaudtertrais/25fc5a2e64fe5d0e86894094c6989e10*/\n  return arr.map((val, i) => arrs.reduce((a, arr) => [...a, arr[i]], [val]));\n};\n\nexport function sum(a, b) {\n  return a + b;\n}\n\nexport function arraysEqual(A, B) {\n  return (\n    (A.length === 0 && B.length === 0) ||\n    (A.length === B.length && A.every((e) => B.indexOf(e) > -1))\n  );\n}\n\nexport function checkAndForceMinOrMaxValue(value, minValue, maxValue) {\n  if (value < minValue) {\n    value = minValue;\n  } else if (value > maxValue) {\n    value = maxValue;\n  }\n\n  return value;\n}\n\nexport function areOverlapping(startA, endA, startB, endB) {\n  if (startB < startA) {\n    return endB >= startA;\n  } else if (startB > startA) {\n    return startB <= endA;\n  } else {\n    return true;\n  }\n}\n\n// Short-circuiting, and saving a parse operation\nexport function isInt(value) {\n  var x;\n  if (isNaN(value)) {\n    return false;\n  }\n  x = parseFloat(value);\n  return (x | 0) === x;\n}\n\nexport function calculateEndBinFromScreen(\n  beginBin,\n  selZoomLev,\n  store,\n  widthInColumns\n) {\n  //console.log(\"calculateEndBinFromScreen: widthInColumns --> \" + widthInColumns);\n\n  let chunkURLarray = [];\n  let fileArrayFasta = [];\n\n  let firstFieldX = -1;\n\n  const level = store.chunkIndex.zoom_levels.get(selZoomLev);\n  //this loop will automatically cap out at the last bin of the file\n  for (let ichunk = 0; ichunk < level.files.length; ichunk++) {\n    // The \"x\" info is not here\n    const chunk = level.files[ichunk];\n\n    //if (areOverlapping(beginBin, endBin, chunk.first_bin, chunk.last_bin)){\n    if (chunk.last_bin >= beginBin) {\n      const fieldX = store.useWidthCompression ? chunk.compressedX : chunk.x;\n\n      if (firstFieldX === -1) {\n        firstFieldX = fieldX;\n      }\n\n      /*console.log(\"fieldX: \" + fieldX);\n      console.log('fieldX - firstFieldX: ' + (fieldX - firstFieldX))\n      console.log(\"chunk.last_bin: \" + chunk.last_bin);*/\n\n      chunkURLarray.push(chunk[\"file\"]);\n      if (chunk.fasta !== null) {\n        fileArrayFasta.push(chunk.fasta);\n      }\n\n      // If the new chunck is outside the windows, the chunk-pushing is over\n      if (fieldX - firstFieldX >= widthInColumns) {\n        break;\n      }\n    }\n  }\n\n  // store.updateBeginEndBin(b, b + widthInColumns);\n  //TODO the logic in let width = could be much more complex by looking at\n  //width of components and whether various settings are on.  The consequence\n  //of overestimating widthInColumns is to make the shift buttons step too big\n  return [chunkURLarray, fileArrayFasta];\n}\n\nexport function range(start, end) {\n  return [...Array(1 + end - start).keys()].map((v) => start + v);\n}\n\nexport function stringToColorAndOpacity(\n  linkColumn,\n  highlightedLinkColumn,\n  selectedLink\n) {\n  const whichLinkToConsider = selectedLink\n    ? selectedLink\n    : highlightedLinkColumn;\n\n  const colorKey = (linkColumn.downstream + 1) * (linkColumn.upstream + 1);\n  if (whichLinkToConsider) {\n    // When the mouse in on a Link, all the other ones will become gray and fade out\n    let matchColor =\n      (whichLinkToConsider.downstream + 1) * (whichLinkToConsider.upstream + 1);\n    // Check if the mouse in on a Link (highlightedLinkColumn) or if a Link was clicked (selectedLink)\n    if ((!highlightedLinkColumn && !selectedLink) || colorKey === matchColor) {\n      return [\n        stringToColourSave(colorKey),\n        1.0,\n        highlightedLinkColumn || selectedLink ? \"black\" : null,\n      ];\n    } else {\n      return [\"gray\", 0.3, null];\n    }\n  } else {\n    return [stringToColourSave(colorKey), 1.0, null];\n  }\n}\n\nexport function stringToColourSave(colorKey) {\n  colorKey = colorKey.toString();\n  let hash = 0;\n  for (let i = 0; i < colorKey.length; i++) {\n    hash = colorKey.charCodeAt(i) + ((hash << 5) - hash);\n  }\n  let colour = \"#\";\n  for (let j = 0; j < 3; j++) {\n    const value = (hash >> (j * 8)) & 0xff;\n    colour += (\"00\" + value.toString(16)).substr(-2);\n  }\n  return colour;\n}\n\n// From https://stackoverflow.com/questions/42623071/maximum-call-stack-size-exceeded-with-math-min-and-math-max/52613386#52613386\n// Not-recursive implementation of Math.max to avoid 'RangeError: Maximum call stack size exceeded' for big arrays\nexport function getMax(arr) {\n  let len = arr.length;\n  let max = -Infinity;\n\n  while (len--) {\n    max = arr[len] > max ? arr[len] : max;\n  }\n  return max;\n}\n","/* eslint-disable require-jsdoc */\nimport React from \"react\";\nimport { Rect } from \"react-konva\";\nimport { ConnectorRect } from \"./ComponentConnectorRect\";\nimport { SpanCell } from \"./SpanCell\";\nimport PropTypes from \"prop-types\";\nimport { sum } from \"./utilities\";\n\nfunction colorFromStr(colorKey) {\n  colorKey = colorKey.toString();\n  let hash = 0;\n  for (let i = 0; i < colorKey.length; i++) {\n    hash = colorKey.charCodeAt(i) + ((hash << 5) - hash);\n  }\n  let colour = \"#\";\n  for (let j = 0; j < 3; j++) {\n    let value = (hash >> (j * 8)) & 0xff;\n    colour += (\"00\" + value.toString(16)).substr(-2);\n  }\n  return colour;\n}\n\nexport function compress_visible_rows(components, pathNames, annotationNames) {\n  /*Returns a Map with key of the original row number and value of the new, compressed row number.\n   * Use this for y values of occupancy and LinkColumn cells.  */\n  let all_visible = new Set();\n  for (let c of components) {\n    for (let row of c.occupants) {\n      all_visible.add(row);\n    }\n  }\n\n  let row_mapping = {};\n  let ordered_num_rows = {};\n  if (annotationNames.length > 0) {\n    let all_annotation_num_rows = new Set();\n    for (let annotationName of annotationNames) {\n      all_annotation_num_rows.add(pathNames.indexOf(annotationName));\n    }\n\n    let row_mapping_high = [];\n    let row_mapping_individuals = [];\n\n    const num_row_ref = pathNames.indexOf(\"NC_045512\");\n\n    for (let num_row of all_visible) {\n      //console.log(num_row + ' -- ' + pathNames[num_row] + ' ----- ' + all_annotation_num_rows.has(num_row))\n      if (num_row !== num_row_ref) {\n        if (all_annotation_num_rows.has(num_row)) {\n          row_mapping_high.push(num_row);\n        } else {\n          row_mapping_individuals.push(num_row);\n        }\n      }\n    }\n\n    if (num_row_ref >= 0) {\n      row_mapping_high.push(num_row_ref);\n    }\n\n    ordered_num_rows = row_mapping_high.concat(row_mapping_individuals);\n  } else {\n    ordered_num_rows = Array.from(all_visible).sort();\n  }\n\n  for (let [count, index] of ordered_num_rows.entries()) {\n    row_mapping[index] = count;\n  }\n\n  return row_mapping;\n}\n\nclass ComponentRect extends React.Component {\n  state = {\n    color: \"lightgray\",\n  };\n\n  handleClick = () => {\n    if (this.state.color === \"lightgray\") {\n      this.setState({ color: \"lightblue\" });\n    } else if (this.state.color === \"lightblue\") {\n      this.setState({ color: \"lightgray\" });\n    }\n  };\n\n  renderMatrix() {\n    let parts = this.props.item.matrix.map((entry, vertical_rank) => {\n      let row_n = entry[0];\n      return this.renderMatrixRow(entry[1], vertical_rank, row_n);\n    });\n    this.props.store.updateMaxHeight(this.props.item.occupants.length); //Set max observed occupants in mobx store for render height\n    return <>{parts}</>;\n  }\n\n  renderMatrixRow(entry, verticalRank, uncompressed_y) {\n    let this_y = verticalRank;\n    if (!this.props.store.useVerticalCompression) {\n      if (!this.props.compressed_row_mapping.hasOwnProperty(uncompressed_y)) {\n        return null; // we need compressed_y and we don't have it.  give up\n      }\n      this_y = this.props.compressed_row_mapping[uncompressed_y];\n    }\n\n    let pathName = this.props.pathNames[uncompressed_y];\n    let rowColor = \"#838383\";\n    if (this.props.store.colorByGeneAnnotation && this.props.store.metaData) {\n      let metaData = this.props.store.metaData;\n      if (metaData.get(pathName) !== undefined) {\n        if (metaData.get(pathName).Color.startsWith(\"#\")) {\n          rowColor = metaData.get(pathName).Color;\n        } else {\n          rowColor = colorFromStr(metaData.get(pathName).Color);\n        }\n      }\n    }\n\n    return (\n      <SpanCell\n        key={\"occupant\" + uncompressed_y}\n        row={entry[1]}\n        iColumns={entry[0]}\n        parent={this.props.item}\n        store={this.props.store}\n        pathName={pathName}\n        color={rowColor}\n        x={\n          this.props.item.relativePixelX +\n          this.props.item.arrivals.length * this.props.store.pixelsPerColumn\n        }\n        y={this_y * this.props.store.pixelsPerRow + this.props.store.topOffset}\n        rowNumber={uncompressed_y}\n        verticalRank={verticalRank}\n      />\n    );\n  }\n\n  renderAllConnectors() {\n    const departures = this.props.item.departures;\n    let connectorsColumn = departures.slice(-1)[0];\n    if (connectorsColumn !== undefined) {\n      //count starts at the sum(sum(departure columns)) so that it's clear\n      // adjacent connectors are alternatives to LinkColumns\n      //offset the y to start below link columns when using vertical compression\n      let yOffset = departures\n        .slice(0, -1)\n        .map((column) => {\n          return column.participants.length;\n        })\n        .reduce(sum, 0); // sum of trues in all columns\n      return (\n        <>\n          {connectorsColumn.participants.map((uncompressed_row) => {\n            yOffset++; // only used in vertical compression\n            return this.renderComponentConnector(yOffset, uncompressed_row);\n          })}\n        </>\n      );\n    } else {\n      return null;\n    }\n  }\n\n  renderComponentConnector(verticalRank, uncompressedRow) {\n    let component = this.props.item;\n    // x is the (num_bins + num_arrivals + num_departures)*pixelsPerColumn\n    const x_val =\n      component.relativePixelX +\n      (component.arrivals.length +\n        (this.props.store.useWidthCompression\n          ? this.props.store.binScalingFactor\n          : component.num_bin) +\n        component.departures.length -\n        1) *\n        this.props.store.pixelsPerColumn;\n    let this_y = verticalRank;\n    if (!this.props.store.useVerticalCompression) {\n      this_y = this.props.compressed_row_mapping[uncompressedRow];\n    }\n    return (\n      <ConnectorRect\n        key={\"connector\" + uncompressedRow}\n        x={x_val}\n        y={this.props.store.topOffset + this_y * this.props.store.pixelsPerRow}\n        width={this.props.store.pixelsPerColumn} //Clarified and corrected adjacent connectors as based on pixelsPerColumn width #9\n        height={this.props.store.pixelsPerRow}\n        color={\"#AAAABE\"}\n      />\n    );\n  }\n\n  render() {\n    return (\n      <>\n        <Rect\n          x={this.props.item.relativePixelX}\n          y={this.props.store.topOffset}\n          key={this.state.key + \"R\"}\n          width={this.props.widthInColumns * this.props.store.pixelsPerColumn}\n          height={this.props.height - 2} //TODO: change to compressed height\n          fill={this.state.color}\n          onClick={this.handleClick}\n          onMouseOver={this.onHover.bind(this)}\n          onMouseLeave={this.onLeave.bind(this)}\n        />\n        {!this.props.store.useWidthCompression ? this.renderMatrix() : null}\n        {this.props.store.useConnector ? this.renderAllConnectors() : null}\n      </>\n    );\n  }\n\n  onHover() {\n    this.props.store.updateCellTooltipContent(\n      \"Bin range: \" + this.props.item.firstBin + \" - \" + this.props.item.lastBin\n    );\n  }\n\n  onLeave() {\n    this.props.store.updateCellTooltipContent(\"\");\n  }\n}\n\nComponentRect.propTypes = {\n  store: PropTypes.object,\n  item: PropTypes.object,\n  compressed_row_mapping: PropTypes.object,\n  widthInColumns: PropTypes.number,\n  height: PropTypes.number,\n  pathNames: PropTypes.node,\n};\n\nexport default ComponentRect;\n","import React from \"react\";\nimport { Text } from \"react-konva\";\nimport PropTypes from \"prop-types\";\n\nclass ComponentNucleotides extends React.Component {\n  renderMatrixRow() {\n    const parent = this.props.item;\n    const x_val =\n      parent.relativePixelX +\n      parent.arrivals.length * this.props.store.pixelsPerColumn;\n\n    //console.log('x_val: ' + x_val)\n\n    var listOfObjects = [];\n    for (var x = 0; x < this.props.item.num_bin; x++) {\n      listOfObjects.push(\n        <Text\n          key={\"nuc_text\" + x}\n          x={x_val + x * this.props.store.pixelsPerColumn}\n          y={this.props.store.topOffset - this.props.store.pixelsPerColumn}\n          text={this.props.nucleotides[x]}\n          align=\"center\"\n          height={this.props.store.pixelsPerColumn}\n          width={this.props.store.pixelsPerColumn}\n          fontSize={this.props.store.pixelsPerColumn + 2}\n        />\n      );\n    }\n    return listOfObjects;\n  }\n\n  render() {\n    //console.log('ComponentNucleotides - render')\n    return this.renderMatrixRow();\n  }\n}\n\nComponentNucleotides.propTypes = {\n  store: PropTypes.object,\n  item: PropTypes.object,\n};\n\nexport default ComponentNucleotides;\n","import React from \"react\";\nimport {Rect} from \"react-konva\";\nimport PropTypes from \"prop-types\";\nimport {range} from \"./utilities\";\n\nclass LinkColumn extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleMouseOut = this.handleMouseOut.bind(this);\n    this.handleMouseOver = this.handleMouseOver.bind(this);\n  }\n  handleMouseOver() {\n    this.props.updateHighlightedNode(this.props.item);\n  }\n  handleMouseOut() {\n    this.props.updateHighlightedNode(null);\n  }\n  linkCells() {\n      if (!this.props.store.useVerticalCompression) { //regular layout\n          return this.props.item.participants.map((pathIndex) =>\n              this.props.compressed_row_mapping[pathIndex] * this.props.store.pixelsPerRow);\n      }\n      //else, just stack each up at the top of the screen\n      return range(0, this.props.item.participants.length).map(\n          (y) => y * this.props.store.pixelsPerRow);\n  }\n  componentDidMount() {\n    this.setState({\n      color: this.props.color,\n    });\n  }\n  render() {\n    const contents = this.linkCells();\n    return (\n      <>\n        {contents.map((y_coord, d) => {\n          return (\n            <Rect\n              key={\"dot\" + d}\n              x={this.props.x}\n              y={\n                this.props.store.topOffset +\n                y_coord\n              }\n              width={this.props.store.pixelsPerColumn}\n              height={this.props.store.pixelsPerRow}\n              fill={this.props.color}\n              opacity={this.props.opacity}\n              stroke={this.props.stroke}\n              // onClick={this.handleClick}\n              onMouseOver={this.handleMouseOver}\n              onMouseOut={this.handleMouseOut}\n            />\n          );\n        })}\n      </>\n    );\n  }\n}\n\nLinkColumn.propTypes = {\n  store: PropTypes.object,\n  item: PropTypes.object,\n  updateHighlightedNode: PropTypes.func,\n  compressed_row_mapping: PropTypes.object,\n  x: PropTypes.node,\n  column: PropTypes.node,\n  color: PropTypes.node,\n};\n\nexport default LinkColumn;\n","import React from \"react\";\nimport { Arrow } from \"react-konva\";\nimport PropTypes from \"prop-types\";\n\nfunction isInfinity(n) {\n  return !Number.isFinite(n);\n}\n\nclass LinkArrow extends React.Component {\n  /** Serves as a contract to store visual layout information**/\n  constructor(props) {\n    super(props);\n    this.arrowXCoord = null;\n    this.points = [];\n    this.handleMouseOut = this.handleMouseOut.bind(this);\n    this.handleMouseOver = this.handleMouseOver.bind(this);\n  }\n  componentDidUpdate() {\n    //this.calculatePoints();\n  }\n\n  calculatePoints() {\n    /*Translates the LinkRecord coordinates into pixels and defines the curve shape.\n     * I've spent way too long fiddling with these numbers at different pixelsPerColumn\n     * I suggest you don't fiddle with them unless you plan on nesting the React\n     * Components to ensure that everything is relative coordinates.*/\n    let link = this.props.link;\n    this.arrowXCoord = this.props.link.xArrival;\n    let absDepartureX = this.props.link.xDepart;\n    // put in relative coordinates to arriving LinkColumn\n    let departureX =\n      absDepartureX - this.arrowXCoord + this.props.store.pixelsPerColumn / 2;\n    let arrX = this.props.store.pixelsPerColumn / 2;\n    let bottom = -2; //-this.props.store.pixelsPerColumn;\n    let turnDirection = departureX < 0 ? -1 : 1;\n    const departOrigin = [departureX, this.props.store.pixelsPerColumn - 2];\n    const departCorner = [departureX - turnDirection, -link.elevation + 2];\n    let departTop = [departureX - turnDirection * 6, -link.elevation];\n    let arriveTop = [arrX + turnDirection * 6, -link.elevation];\n    let arriveCorner = [arrX + turnDirection, -link.elevation + 2]; // 1.5 in from actual corner\n    const arriveCornerEnd = [arrX, -5];\n    this.points = [\n      departOrigin[0],\n      departOrigin[1],\n      departCorner[0],\n      departCorner[1],\n      departTop[0],\n      departTop[1],\n      arriveTop[0],\n      arriveTop[1],\n      arriveCorner[0],\n      arriveCorner[1],\n      arriveCornerEnd[0],\n      arriveCornerEnd[1],\n      arrX,\n      -1,\n    ];\n    if (Math.abs(departureX) <= this.props.store.pixelsPerColumn) {\n      // FIXME Small distances, usually self loops\n      if (link.isArrival) {\n        this.points = [\n          arrX,\n          -10, //-link.elevation - 4,\n          arrX,\n          bottom,\n        ];\n      } else {\n        this.points = [\n          departOrigin[0],\n          bottom + this.props.store.pixelsPerColumn,\n          departOrigin[0],\n          -5,\n        ]; //-link.elevation-this.props.store.pixelsPerColumn*2,];\n      }\n    }\n    if (this.points.some(isNaN) || this.points.some(isInfinity)) {\n      console.log(\"Some points are NaN: \" + this.points);\n    }\n  }\n\n  render() {\n    // if(this.arrowXCoord === null){\n    this.calculatePoints();\n    // }\n    /*upstream={this.props.upstream}\n        downstream={this.props.downstream}\n        */\n\n    return (\n      <Arrow\n        x={this.arrowXCoord}\n        y={this.props.store.topOffset - this.props.store.pixelsPerColumn}\n        width={this.props.store.pixelsPerColumn}\n        points={this.points}\n        bezier={false}\n        strokeWidth={this.props.store.pixelsPerColumn}\n        fill={this.props.color}\n        stroke={this.props.color}\n        opacity={this.props.opacity}\n        stroke-opacity={this.props.opacity}\n        pointerLength={1}\n        pointerWidth={1}\n        tension={1 / 3}\n        onMouseOver={this.handleMouseOver}\n        onMouseOut={this.handleMouseOut}\n        onClick={this.handleClick}\n        // lineCap={'round'}\n      />\n    );\n  }\n\n  handleMouseOver = () => {\n    this.props.store.updateCellTooltipContent(\n      \"Bin upstream: \" +\n        this.props.link.linkColumn.upstream +\n        \"\\nBin downstream: \" +\n        this.props.link.linkColumn.downstream\n    );\n\n    this.props.updateHighlightedNode(this.props.link.linkColumn);\n  };\n  handleMouseOut = () => {\n    this.props.store.updateCellTooltipContent(\"\");\n\n    this.props.updateHighlightedNode(null);\n  };\n  handleClick = (event) => {\n    console.log(\"Click\", event, this.props.link);\n\n    this.props.updateSelectedLink(this.props.link.linkColumn);\n  };\n}\n\nLinkArrow.propTypes = {\n  store: PropTypes.object,\n  link: PropTypes.object,\n  color: PropTypes.node,\n};\n\nexport default LinkArrow;\n","import { getMax } from \"./utilities\";\n\nexport class LinkRecord {\n  constructor(linkColumn, xCoordArrival = 0, xCoordDeparture = 0, isArrival) {\n    this.linkColumn = linkColumn;\n    if (linkColumn === undefined) {\n      console.log(linkColumn, xCoordArrival, xCoordDeparture);\n    }\n    this.xArrival = xCoordArrival;\n    this.xDepart = xCoordDeparture;\n    this.elevation = 10;\n    this.isArrival = isArrival;\n  }\n  distance() {\n    return Math.abs(this.xDepart - this.xArrival) || 1;\n  }\n}\n\nexport function calculateLinkCoordinates(\n  schematic,\n  pixelsPerColumn,\n  topOffset,\n  useWidthCompression,\n  binScalingFactor,\n  leftXStart,\n  index_to_component_to_visualize_dict\n) {\n  //leftXStart is necessary as a method at the moment\n  /** calculate the x coordinates of all components\n   * calculate the x coordinates of all arrivals and departures */\n\n  /* In this dictionary the key is the global unique paddedKey created by @edgetoKey.\n    The value is a list of size 2:\n    1. Element: the x-coordinate of the arrival link column\n    2. Element: the x-coordinate of the corresponding departure link column */\n  let linkToXMapping = {}; //(paddedKey): [arrivalX, departureX]\n\n  for (let i = 0; i < schematic.length; i++) {\n    let schematizeComponent = schematic[i];\n\n    if (schematizeComponent.index in index_to_component_to_visualize_dict) {\n      //schematizeComponent.relativePixelX = leftXStart(schematizeComponent, i, 0, 0);\n      //ARRIVALS: Calculate all X\n      for (let j = 0; j < schematizeComponent.arrivals.length; j++) {\n        let arrival = schematizeComponent.arrivals[j];\n        let xCoordArrival = leftXStart(schematizeComponent, i, 0, j);\n        let paddedKey = arrival.key;\n        if (!(paddedKey in linkToXMapping)) {\n          //place holder value, go as far right as possible\n          // TODO place holder value in the same place\n          linkToXMapping[paddedKey] = new LinkRecord(\n            arrival,\n            xCoordArrival,\n            xCoordArrival,\n            true\n          );\n        } else {\n          linkToXMapping[paddedKey].xArrival = xCoordArrival; // set with real value\n        }\n      }\n      //DEPARTURES: Calculate all X\n      for (let k = 0; k < schematizeComponent.departures.length - 1; k++) {\n        let departure = schematizeComponent.departures[k];\n        let xCoordDeparture = leftXStart(\n          schematizeComponent,\n          i,\n          schematizeComponent.arrivals.length +\n            (useWidthCompression\n              ? binScalingFactor\n              : schematizeComponent.num_bin),\n          k\n        );\n        let paddedKey = departure.key;\n        if (!(paddedKey in linkToXMapping)) {\n          //place holder value, go as far left as possible\n          // linkToXMapping[paddedKey] = [this.state.actualWidth + 100, xCoordDeparture]\n          linkToXMapping[paddedKey] = new LinkRecord(\n            departure,\n            xCoordDeparture,\n            xCoordDeparture,\n            false\n          );\n        } else {\n          linkToXMapping[paddedKey].xDepart = xCoordDeparture; // set real value\n        }\n      }\n    }\n  }\n  return calculateLinkElevations(linkToXMapping, pixelsPerColumn, topOffset);\n}\n\nfunction calculateLinkElevations(linkToXmapping, pixelsPerColumn, topOffset) {\n  /**Starting with the shortest links, claim a spot of elevation to place the link in.\n   * As the links get bigger, you take the max() of the range of the link and add 1.\n   * This claims the \"air space\" for that link to travel through without colliding with anything.\n   * The longest link should end up on top.  We'll probably need a \"link gutter\" maximum to keep\n   * this from getting unreasonably tall.**/\n  const distanceSortedLinks = Object.values(linkToXmapping).sort(\n    (a, b) => a.distance() - b.distance()\n  );\n  const elevationOccupied = reserveElevationAirSpace(\n    distanceSortedLinks,\n    pixelsPerColumn,\n    topOffset\n  );\n\n  let top = pixelsPerColumn * 3;\n  if (elevationOccupied.length > 0) {\n    top += getMax(elevationOccupied);\n  }\n  return [distanceSortedLinks, top];\n}\n\nfunction reserveElevationAirSpace(\n  distanceSortedLinks,\n  pixelsPerColumn,\n  topOffset\n) {\n  /* Set up an array of zeros, then gradually fill it with height stacking\n   * @Simon this section is largely done, it just needs a sorted distanceSortedLinks as input*/\n\n  const length = Math.max(\n    0,\n    getMax(distanceSortedLinks.map((x) => Math.max(x.xDepart, x.xArrival)))\n  );\n\n  let elevationOccupied = new Array(length).fill(15);\n  for (let record of distanceSortedLinks) {\n    let linkBegin = Math.max(0, Math.min(record.xArrival, record.xDepart));\n    let linkEnd = Math.max(record.xArrival, record.xDepart, linkBegin + 1);\n    let range = elevationOccupied.slice(linkBegin, linkEnd + 1);\n    let elevation = range.length ? Math.max(...range) : 10;\n    if (isNaN(elevation) || !Number.isFinite(elevation)) {\n      console.log(\n        \"Bad elevation\",\n        record,\n        linkBegin,\n        linkEnd,\n        range,\n        elevationOccupied\n      );\n    }\n    const stillSmall = true; //elevation < topOffset / 3;\n    elevation += stillSmall ? pixelsPerColumn : pixelsPerColumn / 4;\n    for (let x = linkBegin; x < linkEnd && x < elevationOccupied.length; x++) {\n      elevationOccupied[x] = elevation;\n    }\n    record.elevation = elevation; //storing final value for render\n  }\n  return elevationOccupied;\n}\n","import { Layer, Stage, Text, Rect, Arrow } from \"react-konva\";\nimport React, { Component } from \"react\";\n\nimport \"./App.css\";\nimport PangenomeSchematic from \"./PangenomeSchematic\";\nimport ComponentRect, { compress_visible_rows } from \"./ComponentRect\";\nimport ComponentNucleotides from \"./ComponentNucleotides\";\nimport LinkColumn from \"./LinkColumn\";\nimport LinkArrow from \"./LinkArrow\";\nimport { calculateLinkCoordinates } from \"./LinkRecord\";\nimport NucleotideTooltip from \"./NucleotideTooltip\";\nimport ControlHeader from \"./ControlHeader\";\nimport { observe } from \"mobx\";\nimport {\n  arraysEqual,\n  calculateEndBinFromScreen,\n  stringToColorAndOpacity,\n} from \"./utilities\";\n\n//import makeInspectable from \"mobx-devtools-mst\";\n// TO_DO: improve the management of visualized components\nlet index_to_component_to_visualize_dict;\n\nfunction Legend() {\n  return (\n    <img\n      src={process.env.PUBLIC_URL + \"/Schematize legend.gif\"}\n      alt=\"legend\"\n      style={{\n        position: \"fixed\",\n        bottom: \"20px\",\n        left: \"20px\",\n        background: \"white\",\n        align: \"right\",\n        width: \"100px\",\n        height: \"200px\",\n      }}\n    />\n  );\n}\n\nclass App extends Component {\n  layerRef = React.createRef();\n  layerRef2 = React.createRef();\n  layerNavigationBar = React.createRef();\n\n  // Timer for the LinkArrow highlighting and selection (clicking on it)\n  timerHighlightingLink = null;\n  timerSelectionLink = null;\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      schematize: [],\n      pathNames: [],\n      actualWidth: 1,\n      buttonsHeight: 0,\n    };\n    this.schematic = new PangenomeSchematic({ store: this.props.store }); //Read file, parse nothing\n\n    /* == State control flow --> redundancies here can waste processing time\n    * STEP #1: whenever jsonName changes, loadIndexFile\n    * STEP #2: chunkIndex contents loaded\n    * STEP #3: with new chunkIndex, this.openRelevantChunksFromIndex()\n    * STEP #4: Set switchChunkURLs\n    * STEP #5: once ChunkURLs are listed, go fetchAllChunks\n    * STEP #6: fetched chunks go into loadJsonCache\n    * STEP #7: JsonCache causes processArray to update chunksProcessed\n    * STEP #8: chunksProcessed finishing triggers updateSchematicMetadata with final rendering info for this loaded chunks\n      * STEP #9: reserveAirspace\n      * STEP #10: calcMaxNumRowsAcrossComponents\n    //TODO: separate processArray into its  own observer\n    * STEP #11: Y values calculated, trigger do the render\n    * */\n\n    //Arrays must be observed directly, simple objects are observed by name\n    //STEP #5: once ChunkURLs are listed, go fetchAllChunks\n    observe(this.props.store.chunkURLs, this.fetchAllChunks.bind(this));\n\n    observe(\n      this.props.store,\n      \"useVerticalCompression\",\n      this.updateSchematicMetadata.bind(this)\n    );\n    observe(\n      this.props.store,\n      \"useWidthCompression\",\n      this.openRelevantChunksFromIndex.bind(this)\n    );\n    //observe(this.props.store, \"colorByGeneAnnotation\", this.recalcY.bind(this));\n\n    observe(this.props.store, \"useConnector\", this.recalcXLayout.bind(this)); //TODO faster rerender\n\n    observe(\n      this.props.store,\n      \"pixelsPerColumn\",\n      this.openRelevantChunksFromIndex.bind(this)\n    ); //TODO faster rerender\n    observe(this.props.store, \"pixelsPerRow\", this.recalcY.bind(this)); //TODO faster rerender\n\n    //STEP #8: chunksProcessed finishing triggers updateSchematicMetadata with final\n    // rendering info for this loaded chunks\n    observe(\n      this.props.store.chunksProcessed,\n      this.updateSchematicMetadata.bind(this)\n    );\n    observe(\n      this.props.store.chunksProcessedFasta,\n      this.updateSchematicMetadata.bind(this)\n    );\n\n    //STEP #11: Y values calculated, trigger do the render\n    observe(this.props.store, \"loading\", this.render.bind(this));\n\n    //STEP #3: with new chunkIndex, openRelevantChunksFromIndex\n    observe(\n      this.props.store,\n      \"chunkIndex\",\n      this.openRelevantChunksFromIndex.bind(this)\n    );\n\n    observe(\n      this.props.store,\n      \"indexSelectedZoomLevel\",\n      this.openRelevantChunksFromIndex.bind(this) // Whenever the selected zoom level changes\n    );\n    observe(\n      this.props.store.beginEndBin, //user moves start position\n      //This following part is important to scroll right and left on browser\n      () => {\n        console.log(\n          \"Updated Begin and End bin: \" + this.props.store.beginEndBin\n        );\n        this.openRelevantChunksFromIndex();\n      }\n    );\n\n    // For debugging purposes\n    //makeInspectable(this.props.store);\n  }\n\n  prepareWhichComponentsToVisualize(widthInColumns) {\n    //console.log(\"prepareWhichComponentsToVisualize: widthInColumns --> \" + widthInColumns);\n\n    // It prepares a dictionary with the components to visualize. It is improvable putting all the components\n    // in a dictionary (this.schematic.components becames a dictionary).\n\n    index_to_component_to_visualize_dict = {};\n\n    const beginBin = this.props.store.getBeginBin();\n    let newEndBin = this.props.store.getEndBin();\n\n    let firstFieldX = -1;\n\n    for (const schematizeComponent of this.schematic.components) {\n      if (schematizeComponent.lastBin >= beginBin) {\n        const fieldX = schematizeComponent.getColumnX(\n          this.props.store.useWidthCompression\n        );\n\n        if (firstFieldX === -1) {\n          firstFieldX = fieldX;\n\n          // The first component can be partially visualized\n          widthInColumns += this._column_shift(schematizeComponent);\n        }\n\n        /*console.log(\"fieldX: \" + fieldX);\n        console.log('fieldX - firstFieldX: ' + (fieldX - firstFieldX))\n        console.log(\"schematizeComponent.lastBin: \" + schematizeComponent.lastBin);*/\n\n        // If the new component is outside the windows, the preparation is over\n        // TO_DO: take into account the shifted columns in the normal visualization mode (rearrangements + full components)\n        if (fieldX - firstFieldX >= widthInColumns) {\n          break;\n        }\n\n        index_to_component_to_visualize_dict[\n          schematizeComponent.index\n        ] = schematizeComponent;\n\n        newEndBin = schematizeComponent.lastBin;\n      }\n\n      //console.log('newEndBin: ' + newEndBin)\n    }\n\n    //console.log(this.schematic.components.length)\n    //console.log(this.props.store.getBeginBin() + ' - ' + this.props.store.getEndBin())\n    //console.log('index_to_component_to_visualize_dict: '  + Object.keys(index_to_component_to_visualize_dict))\n\n    return newEndBin;\n  }\n\n  /** Compares bin2file @param indexContents with the beginBin and EndBin.\n   * It finds the appropriate chunk URLS from the index and updates\n   * switchChunkURLs which trigger json fetches for the new chunks. **/\n  openRelevantChunksFromIndex() {\n    console.log(\n      \"STEP #3: with new chunkIndex, this.openRelevantChunksFromIndex()\"\n    );\n\n    if (\n      this.props.store.chunkIndex === null ||\n      !this.props.store.chunkIndex.zoom_levels.keys()\n    ) {\n      return; //before the class is fully initialized\n    }\n    const beginBin = this.props.store.getBeginBin();\n\n    // With new chunkIndex, it sets the available zoom levels\n    this.props.store.setAvailableZoomLevels(\n      this.props.store.chunkIndex[\"zoom_levels\"].keys()\n    );\n\n    const widthInColumns = window.innerWidth / this.props.store.pixelsPerColumn;\n\n    const selZoomLev = this.props.store.getSelectedZoomLevel();\n    let [fileArray, fileArrayFasta] = calculateEndBinFromScreen(\n      beginBin,\n      selZoomLev,\n      this.props.store,\n      widthInColumns\n    );\n    this.props.store.setLastBinPangenome(\n      this.props.store.chunkIndex.zoom_levels.get(selZoomLev)[\"last_bin\"]\n    );\n\n    const scaling_factor =\n      this.props.store.getSelectedZoomLevel(true) /\n      this.props.store.getSelectedZoomLevel();\n\n    //console.log(\"scaling_factor: \" + scaling_factor);\n\n    if (scaling_factor !== 1) {\n      this.props.store.updateBeginEndBin(\n        Math.round((beginBin - 1) * scaling_factor),\n        Math.round((this.props.store.getEndBin() - 1) * scaling_factor)\n      );\n      // The updating will re-trigger openRelevantChunksFromIndex\n    } else {\n      const newEndBin = this.prepareWhichComponentsToVisualize(widthInColumns);\n      this.props.store.updateBeginEndBin(beginBin, newEndBin);\n\n      //console.log([selZoomLev, endBin, fileArray, fileArrayFasta]);\n      let URLprefix =\n        process.env.REACT_APP_FETCH +\n        this.props.store.jsonName +\n        \"/\" +\n        selZoomLev +\n        \"/\";\n      fileArray = fileArray.map((filename) => {\n        return URLprefix + filename;\n      });\n      fileArrayFasta = fileArrayFasta.map((filename) => {\n        return URLprefix + filename;\n      });\n\n      this.props.store.switchChunkFastaURLs(fileArrayFasta);\n\n      // If there are no new chunck, it has only to recalculate the X layout\n      if (!this.props.store.switchChunkURLs(fileArray)) {\n        this.recalcXLayout();\n      }\n    }\n  }\n\n  fetchAllChunks() {\n    /*Dispatches fetches for all chunk files\n     * Read https://github.com/graph-genome/Schematize/issues/22 for details\n     */\n    console.log(\"STEP #5: once ChunkURLs are listed, go fetchAllChunks\");\n    //console.log(\"fetchAllChunks\", this.props.store.chunkURLs);\n    if (!this.props.store.chunkURLs.get(0)) {\n      console.warn(\"No chunk URL defined.\");\n      return;\n    }\n    for (let chunkPath of this.props.store.chunkURLs) {\n      //TODO: conditional on jsonCache not already having chunk\n      //console.log(\"fetchAllChunks - START reading: \" + chunkPath);\n      this.schematic.jsonFetch(chunkPath).then((data) => {\n        //console.log(\"fetchAllChunks - END reading: \" + chunkPath);\n        this.schematic.loadJsonCache(chunkPath, data);\n      });\n    }\n  }\n\n  updateSchematicMetadata() {\n    if (\n      arraysEqual(\n        this.props.store.chunkURLs,\n        this.props.store.chunksProcessed\n      ) &&\n      arraysEqual(\n        this.props.store.chunkFastaURLs,\n        this.props.store.chunksProcessedFasta\n      )\n    ) {\n      console.log(\n        \"updateSchematicMetadata #components: \" +\n          this.schematic.components.length\n      );\n      console.log(\n        \"STEP #8: chunksProcessed finishing triggers updateSchematicMetadata with final rendering info for this loaded chunks\"\n      );\n\n      const newEndBin = this.prepareWhichComponentsToVisualize(\n        window.innerWidth / this.props.store.pixelsPerColumn\n      );\n      this.props.store.updateBeginEndBin(\n        this.props.store.getBeginBin(),\n        newEndBin\n      );\n\n      // console.log(this.schematic.components);\n      this.setState(\n        {\n          schematize: this.schematic.components,\n          pathNames: this.schematic.pathNames,\n        },\n        () => {\n          this.recalcXLayout();\n\n          this.compressed_row_mapping = compress_visible_rows(\n            this.schematic.components,\n            this.schematic.pathNames,\n            Array.from(this.props.store.metaData.keys())\n          );\n          this.maxNumRowsAcrossComponents = this.calcMaxNumRowsAcrossComponents(\n            this.schematic.components\n          ); // TODO add this to mobx-state-tree\n          this.props.store.setLoading(false);\n        }\n      );\n    }\n  }\n\n  recalcXLayout() {\n    console.log(\"recalcXLayout\");\n\n    // In this way the updated relativePixelX information is available everywhere for the rendering\n    for (const [\n      i,\n      schematizeComponent,\n    ] of this.schematic.components.entries()) {\n      schematizeComponent.relativePixelX = this.leftXStart(\n        schematizeComponent,\n        i,\n        0,\n        0\n      );\n    }\n\n    let actualWidth = 0;\n    if (Object.values(index_to_component_to_visualize_dict).length > 0) {\n      // The actualWidth is calculated on the visualized components\n\n      const first_visualized_component = Object.values(\n        index_to_component_to_visualize_dict\n      )[0];\n      const last_visualized_component = Object.values(\n        index_to_component_to_visualize_dict\n      )[Object.values(index_to_component_to_visualize_dict).length - 1];\n\n      const columnsInComponents =\n        last_visualized_component.getColumnX(\n          this.props.store.useWidthCompression\n        ) -\n        first_visualized_component.getColumnX(\n          this.props.store.useWidthCompression\n        ) +\n        last_visualized_component.arrivals.length +\n        last_visualized_component.departures.length +\n        (this.props.store.useWidthCompression\n          ? this.props.store.binScalingFactor\n          : last_visualized_component.num_bin) -\n        this._column_shift(first_visualized_component);\n\n      actualWidth = columnsInComponents * this.props.store.pixelsPerColumn;\n      //+ paddingBetweenComponents;\n    }\n\n    this.setState({\n      actualWidth: actualWidth,\n    });\n\n    const [links, top] = calculateLinkCoordinates(\n      this.schematic.components,\n      this.props.store.pixelsPerColumn,\n      this.props.store.topOffset,\n      this.props.store.useWidthCompression,\n      this.props.store.binScalingFactor,\n      this.leftXStart.bind(this),\n      index_to_component_to_visualize_dict\n    );\n    this.distanceSortedLinks = links;\n    this.props.store.updateTopOffset(parseInt(top));\n  }\n\n  recalcY() {\n    // forceUpdate() doesn't work with callback function\n    this.setState({ highlightedLink: null }); // nothing code to force update.\n  }\n\n  calcMaxNumRowsAcrossComponents(components) {\n    let lengths = components.map((x) => {\n      return x.occupants.length;\n    });\n    return Math.max(...lengths); //this should likely be faster than doing a search for true values\n  }\n\n  visibleHeightPixels() {\n    if (index_to_component_to_visualize_dict === undefined) {\n      return 0;\n    }\n\n    if (\n      this.props.store.useVerticalCompression ||\n      !this.compressed_row_mapping\n    ) {\n      // this.state.schematize.forEach(value => Math.max(value.occupants.filter(Boolean).length, maxNumberRowsInOneComponent));\n      if (this.maxNumRowsAcrossComponents === undefined) {\n        this.maxNumRowsAcrossComponents = this.calcMaxNumRowsAcrossComponents(\n          Object.values(index_to_component_to_visualize_dict)\n        );\n      }\n      /*console.log(\n        \"maxNumRowsAcrossComponents\",\n        this.maxNumRowsAcrossComponents\n      );*/\n\n      return (\n        (this.maxNumRowsAcrossComponents + 1) * this.props.store.pixelsPerRow\n      );\n    } else {\n      return (\n        //TODO: NOTE that Object.keys is wrong if you change compressed_row_mapping to a mobx object\n        (Object.keys(this.compressed_row_mapping).length + 0.25) *\n        this.props.store.pixelsPerRow\n      );\n    }\n  }\n\n  componentDidMount = () => {\n    let buttonContainerDiv = document.getElementById(\"button-container\");\n    let clientHeight = buttonContainerDiv.clientHeight;\n\n    const arrowsDiv = document.getElementsByClassName(\"konvajs-content\")[0];\n    arrowsDiv.style.position = \"relative\";\n\n    this.setState({ buttonsHeight: clientHeight });\n\n    this.layerRef.current.getCanvas()._canvas.id = \"cnvs\";\n    this.layerRef.current.getCanvas()._canvas.position = \"relative\";\n\n    this.layerRef2.current.getCanvas()._canvas.id = \"arrow\";\n    this.layerRef2.current.getCanvas()._canvas.position = \"relative\";\n    //this.layerRef2.current.getCanvas()._canvas.style.top = \"95px\";\n    /*if(this.props.store.useVerticalCompression) {\n      this.props.store.resetRenderStats(); //FIXME: should not require two renders to get the correct number\n    }*/\n  };\n\n  // Now it is wrapped in the updateHighlightedNode() function\n  _updateHighlightedNode(linkRect) {\n    this.setState({ highlightedLink: linkRect });\n  }\n\n  // Wrapper function to wrap the logic (no link selected and time delay)\n  updateHighlightedNode = (linkRect) => {\n    // The highlighting has to work only if there isn't any selected link\n    if (!this.state.selectedLink) {\n      if (linkRect != null) {\n        // It comes from an handleMouseOver event\n\n        clearTimeout(this.timerHighlightingLink);\n\n        // To avoid unnecessary rendering when linkRect is still the this.state.highlightedLink link.\n        if (this.state.highlightedLink !== linkRect) {\n          // This ES6 syntaxt avoid to pass the result of the callback to setTimeoutwork.\n          // It works because the ES6 arrow function does not change the context of this.\n          this.timerHighlightingLink = setTimeout(\n            () => {\n              this._updateHighlightedNode(linkRect);\n            },\n            600 // TODO: value to tune. Create a config file where all these hard-coded settings will be\n          );\n        }\n      } else {\n        // It comes from an handleMouseOut event\n\n        clearTimeout(this.timerHighlightingLink);\n\n        // To avoid unnecessary rendering when linkRect == null and this.state.highlightedLink is already null for any reason.\n        if (this.state.highlightedLink != null) {\n          this.timerHighlightingLink = setTimeout(\n            () => {\n              this._updateHighlightedNode(linkRect);\n            },\n            600 // TODO: value to tune. Create a config file where all these hard-coded settings will be\n          );\n        }\n      }\n    }\n  };\n\n  updateSelectedLink = (linkRect) => {\n    console.log(\"updateSelectedLink\");\n\n    let update_state = false;\n\n    if (linkRect) {\n      //TO_DO: lift down this logic when it will be visualized partial chunks (or\n      // pass info about the visualized chunks to the LinkArrow tags)\n      const [binLeft, binRight] = [linkRect.upstream, linkRect.downstream].sort(\n        function (a, b) {\n          return a - b;\n        }\n      );\n\n      /*console.log([linkRect.upstream, linkRect.downstream])\n      console.log(binLeft, binRight)*/\n      if (Object.values(index_to_component_to_visualize_dict).length === 0) {\n        return; //bug: inconsistent state, just cancel the click event\n      }\n      const last_bin_last_visualized_component = Object.values(\n        index_to_component_to_visualize_dict\n      ).slice(-1)[0].lastBin;\n      // if (linkRect !== this.state.selectedLink) //else it is a re-clik on the same link, so do nothing here\n\n      const [beginBin, endBin] = this.props.store.beginEndBin;\n      if (binLeft < beginBin || binRight > last_bin_last_visualized_component) {\n        console.log(\"updateSelectedLink - NewBeginEndBin\");\n\n        const end_closer =\n          Math.abs(beginBin - binLeft) > Math.abs(endBin - binRight);\n\n        let [newBeginBin, newEndBin] = this.props.store.beginEndBin;\n        let screenWidth = endBin - beginBin;\n        let half = Math.floor(screenWidth / 2);\n        if (end_closer) {\n          [newBeginBin, newEndBin] = [binLeft - half, binLeft + half];\n        } else {\n          [newBeginBin, newEndBin] = [binRight - half, binRight + half];\n        }\n\n        this.props.store.updateBeginEndBin(newBeginBin, newEndBin);\n        update_state = true;\n      }\n    }\n\n    clearTimeout(this.timerHighlightingLink);\n\n    // Update the rendering if it is selected a new arrow (or deselected the last one) or\n    // if the range in changed (clicking on a new arrow or recliking on the same one)\n    if (linkRect !== this.selectedLink || update_state) {\n      console.log(\"updateSelectedLink - NewSelection\");\n\n      this.setState({\n        highlightedLink: linkRect,\n        selectedLink: linkRect,\n      });\n    }\n\n    // Auto de-selection after a delay\n    if (linkRect) {\n      console.log(\"Timer deselection\");\n\n      // Eventually restart the timer if it was already ongoing\n      clearTimeout(this.timerSelectionLink);\n\n      this.timerSelectionLink = setTimeout(\n        () => {\n          this.updateSelectedLink(null);\n        },\n        5000 // TODO: to tune. Create a config file where all these hard-coded settings will be\n      );\n    }\n  };\n\n  // Specific utility function to calculate the visualization shift for the first partial visualized component\n  _column_shift(first_visualized_component) {\n    return !this.props.store.useWidthCompression\n      ? first_visualized_component.firstBin === this.props.store.getBeginBin()\n        ? 0\n        : first_visualized_component.arrivals.length +\n          (this.props.store.getBeginBin() - first_visualized_component.firstBin)\n      : 0; // When only rearrangements are shown, the width does not correspond to the number of bin, so for now we avoid any shifting\n  }\n\n  leftXStart(schematizeComponent, i, firstDepartureColumn, j) {\n    // Avoid calling the function too early or for not visualized components\n    if (!(schematizeComponent.index in index_to_component_to_visualize_dict)) {\n      return;\n    }\n\n    //Return the x coordinate pixel that starts the LinkColumn at i, j\n\n    const first_visualized_component = Object.values(\n      index_to_component_to_visualize_dict\n    )[0];\n\n    /*\n    - \"schematizeComponent.getColumnX(...) - first_visualized_component.getColumnX(..)\": offset of the current component respect to the first visualized one\n    - \"this._column_shift(first_visualized_component)\"\": to hide the arrow on the left\n    - \"(schematizeComponent.index - this.schematic.components[0].index\": number of padding white columns\n    */\n    const previousColumns =\n      schematizeComponent.getColumnX(this.props.store.useWidthCompression) -\n      first_visualized_component.getColumnX(\n        this.props.store.useWidthCompression\n      ) -\n      this._column_shift(first_visualized_component) -\n      (schematizeComponent.index - this.schematic.components[0].index);\n\n    const pixelsFromColumns =\n      (previousColumns + firstDepartureColumn + j) *\n      this.props.store.pixelsPerColumn;\n\n    return pixelsFromColumns + i * this.props.store.pixelsPerColumn;\n  }\n\n  renderComponent(schematizeComponent, i, pathNames) {\n    return (\n      <>\n        <ComponentRect\n          store={this.props.store}\n          item={schematizeComponent}\n          key={\"r\" + i}\n          height={this.visibleHeightPixels()}\n          widthInColumns={\n            schematizeComponent.arrivals.length +\n            (this.props.store.useWidthCompression\n              ? this.props.store.binScalingFactor\n              : schematizeComponent.num_bin) +\n            (schematizeComponent.departures.length - 1)\n          }\n          compressed_row_mapping={this.compressed_row_mapping}\n          pathNames={pathNames}\n        />\n\n        {schematizeComponent.arrivals.map((linkColumn, j) => {\n          return this.renderLinkColumn(\n            schematizeComponent,\n            i,\n            0,\n            j,\n            linkColumn\n          );\n        })}\n        {schematizeComponent.departures.slice(0, -1).map((linkColumn, j) => {\n          let leftPad =\n            schematizeComponent.arrivals.length +\n            (this.props.store.useWidthCompression\n              ? this.props.store.binScalingFactor\n              : schematizeComponent.num_bin);\n\n          return this.renderLinkColumn(\n            schematizeComponent,\n            i,\n            leftPad,\n            j,\n            linkColumn\n          );\n        })}\n      </>\n    );\n  }\n\n  renderLinkColumn(\n    schematizeComponent,\n    i,\n    firstDepartureColumn,\n    j,\n    linkColumn\n  ) {\n    const xCoordArrival = this.leftXStart(\n      schematizeComponent,\n      i,\n      firstDepartureColumn,\n      j\n    );\n    const [localColor, localOpacity, localStroke] = stringToColorAndOpacity(\n      linkColumn,\n      this.state.highlightedLink,\n      this.state.selectedLink\n    );\n    return (\n      <LinkColumn\n        store={this.props.store}\n        key={\"departure\" + i + j}\n        item={linkColumn}\n        pathNames={this.state.pathNames}\n        x={xCoordArrival}\n        pixelsPerRow={this.props.store.pixelsPerRow}\n        width={this.props.store.pixelsPerColumn}\n        color={localColor}\n        opacity={localOpacity}\n        stroke={localStroke}\n        updateHighlightedNode={this.updateHighlightedNode}\n        compressed_row_mapping={this.compressed_row_mapping}\n      />\n    );\n  }\n\n  renderLink(link) {\n    const [localColor, localOpacity] = stringToColorAndOpacity(\n      link.linkColumn,\n      this.state.highlightedLink,\n      this.state.selectedLink\n    );\n\n    return (\n      <LinkArrow\n        store={this.props.store}\n        key={\"arrow\" + link.linkColumn.key}\n        link={link}\n        color={localColor}\n        opacity={localOpacity}\n        updateHighlightedNode={this.updateHighlightedNode}\n        updateSelectedLink={this.updateSelectedLink}\n      />\n    );\n  }\n\n  renderNucleotidesSchematic = () => {\n    if (\n      !this.props.store.loading &&\n      // The conditions on binWidht and useWidthCompression are lifted here,\n      // avoiding any computation if nucleotides have not to be visualized.\n      this.props.store.getBinWidth() === 1 &&\n      !this.props.store.useWidthCompression &&\n      this.props.store.pixelsPerColumn >= 10 &&\n      this.schematic.nucleotides.length > 0\n    ) {\n      //console.log('renderNucleotidesSchematic - START')\n      return Object.values(index_to_component_to_visualize_dict).map(\n        (schematizeComponent, i) => {\n          // The dummy component (firstBin and lastBin equal to 0) is not loaded in this.schematic.components, but there is a nucleotide for it in the FASTA file.\n          // If the first component has firstBin == 1, then in the FASTA there is a nucleotide not visualized, so the shift start from 0, and not 1\n          const nt_shift = this.schematic.components[0].firstBin || 1;\n\n          const nucleotides_slice = this.schematic.nucleotides.slice(\n            schematizeComponent.firstBin - nt_shift, // firstBin is 1 indexed, but this is canceled by nt_shift\n            schematizeComponent.lastBin - nt_shift + 1 // inclusive end\n          );\n\n          //console.log(\"nucleotides_slice: \" + nucleotides_slice);\n\n          return (\n            <React.Fragment key={\"nt\" + i}>\n              <ComponentNucleotides\n                store={this.props.store}\n                item={schematizeComponent}\n                key={i}\n                // They are passed only the nucleotides associated to the current component\n                nucleotides={nucleotides_slice}\n              />\n            </React.Fragment>\n          );\n        }\n      );\n    }\n  };\n\n  renderSchematic() {\n    console.log(\"renderSchematic\");\n\n    if (this.props.store.loading) {\n      return;\n    }\n\n    return this.schematic.components.map((schematizeComponent, i) => {\n      if (schematizeComponent.index in index_to_component_to_visualize_dict) {\n        return (\n          <React.Fragment key={\"f\" + i}>\n            {this.renderComponent(schematizeComponent, i, this.state.pathNames)}\n          </React.Fragment>\n        );\n      } else {\n        return null;\n      }\n    });\n  }\n\n  renderSortedLinks() {\n    if (this.props.store.loading) {\n      return;\n    }\n\n    return this.distanceSortedLinks.map((record, i) => {\n      return this.renderLink(record);\n    });\n  }\n\n  loadingMessage() {\n    if (this.props.store.loading) {\n      return (\n        <Text\n          key=\"loading\"\n          y={100}\n          fontSize={60}\n          width={300}\n          align=\"center\"\n          text=\"Loading...\"\n        />\n      );\n    }\n  }\n\n  handleClick = (event) => {\n    this.props.store.updateBeginEndBin(\n      Math.max(\n        Math.floor(\n          (this.props.store.last_bin_pangenome * event.evt.offsetX) /\n            (event.currentTarget.attrs.width +\n              event.currentTarget.attrs.strokeWidth)\n        ),\n        1\n      ),\n      this.props.store.getEndBin()\n    );\n  };\n  handleMouseMove = (event) => {\n    this.props.store.updateCellTooltipContent(\n      \"Go to bin: \" +\n        Math.max(\n          Math.floor(\n            (this.props.store.last_bin_pangenome * event.evt.offsetX) /\n              (event.currentTarget.attrs.width +\n                event.currentTarget.attrs.strokeWidth)\n          ),\n          1\n        )\n    );\n  };\n  handleMouseOut = () => {\n    this.props.store.updateCellTooltipContent(\"\");\n  };\n\n  render() {\n    console.log(\"Start render\");\n\n    //console.log('renderNucleotidesSchematic - START')\n\n    //this.state.actualWidth - 2\n    const navigation_bar_width = window.innerWidth - 2;\n\n    let x_navigation =\n      this.props.store.getBeginBin() === 1\n        ? 0\n        : Math.ceil(\n            (this.props.store.getBeginBin() /\n              this.props.store.last_bin_pangenome) *\n              navigation_bar_width\n          );\n\n    let width_navigation = Math.ceil(\n      ((this.props.store.getEndBin() - this.props.store.getBeginBin() + 1) /\n        this.props.store.last_bin_pangenome) *\n        navigation_bar_width\n    );\n\n    if (x_navigation + width_navigation > navigation_bar_width) {\n      width_navigation = navigation_bar_width - x_navigation;\n    }\n\n    /*console.log(\"navigation_bar_width \" + navigation_bar_width);\n    console.log(\"x_navigation \" + x_navigation);\n    console.log(\"width_navigation \" + width_navigation);*/\n\n    return (\n      <>\n        <div\n          style={{\n            position: \"sticky\",\n            top: 0,\n            zIndex: \"2\",\n            background: \"white\",\n\n            // To keep the matrix under the container with the vertical scrolling\n            // when the matrix is larger than the page\n            width: this.state.actualWidth,\n\n            // To avoid width too low with large bin_width\n            minWidth: \"100%\",\n          }}\n        >\n          <ControlHeader store={this.props.store} schematic={this.schematic} />\n\n          <Stage\n            x={this.props.store.leftOffset}\n            y={this.props.topOffset}\n            style={{ cursor: \"pointer\" }}\n            width={navigation_bar_width + 2}\n            height={this.props.store.heightNavigationBar + 4}\n          >\n            <Layer ref={this.layerNavigationBar}>\n              <Rect\n                y={2}\n                width={navigation_bar_width}\n                height={this.props.store.heightNavigationBar}\n                fill={\"lightblue\"}\n                stroke={\"gray\"}\n                strokeWidth={2}\n                onMouseMove={this.handleMouseMove}\n                onMouseOut={this.handleMouseOut}\n                onClick={this.handleClick}\n              />\n              <Rect\n                x={x_navigation}\n                y={2}\n                width={width_navigation}\n                height={this.props.store.heightNavigationBar}\n                fill={\"orange\"}\n                stroke={\"brown\"}\n                strokeWidth={2}\n                opacity={0.7}\n              />\n            </Layer>\n          </Stage>\n\n          <Stage\n            x={this.props.store.leftOffset}\n            y={this.props.topOffset}\n            width={this.state.actualWidth}\n            height={this.props.store.topOffset}\n          >\n            <Layer ref={this.layerRef2}>\n              {this.renderSortedLinks()}\n              {this.renderNucleotidesSchematic()}\n            </Layer>\n          </Stage>\n        </div>\n\n        <Stage\n          x={this.props.store.leftOffset} // removed leftOffset to simplify code. Relative coordinates are always better.\n          y={-this.props.store.topOffset} // For some reason, I have to put this, but I'd like to put 0\n          width={this.state.actualWidth}\n          height={this.visibleHeightPixels() + this.props.store.pixelsPerColumn}\n        >\n          <Layer ref={this.layerRef}>\n            {this.loadingMessage()}\n            {this.renderSchematic()}\n          </Layer>\n        </Stage>\n\n        <NucleotideTooltip store={this.props.store} />\n        <Legend store={this.props.store} />\n      </>\n    );\n  }\n}\n\n// render(<App />, document.getElementById('root'));\n\nexport default App;\n","import React from \"react\";\nimport MouseTooltip from \"react-sticky-mouse-tooltip\";\nimport {Observer} from \"mobx-react\";\nimport PropTypes from \"prop-types\";\n\nexport default class NucleotideTooltip extends React.Component {\n  render() {\n    return (\n      <MouseTooltip\n          visible={true}\n          offsetX={15}\n          offsetY={-20}\n          style={{background: \"white\", zIndex: 4, \"whiteSpace\": \"pre-line\"}}\n      >\n        <Observer>\n          {() => <span>{this.props.store.cellToolTipContent}</span>}\n        </Observer>\n      </MouseTooltip>\n    );\n  }\n}\n\nNucleotideTooltip.propTypes = {\n  store: PropTypes.object,\n};\n","import React from \"react\";\nimport { Observer } from \"mobx-react\";\nimport { httpGetAsync } from \"./URL\";\nimport PropTypes from \"prop-types\";\nimport \"./App.css\";\n\nclass ControlHeader extends React.Component {\n  shift(percentage) {\n    const beginBin = this.props.store.getBeginBin();\n    const endBin = this.props.store.getEndBin();\n    let size = endBin - beginBin;\n    let diff = Math.floor(size * (percentage / 100));\n    console.log(endBin + \"-\" + beginBin + \"=\" + size + \" --> diff: \" + diff);\n    this.props.store.updateBeginEndBin(beginBin + diff, endBin + diff);\n  }\n\n  handleJump() {\n    console.log(\n      \"JUMP: path name: \" +\n        this.props.store.pathNucPos.path +\n        \" nucleotide position: \" +\n        this.props.store.pathNucPos.nucPos\n    );\n    // I don't know why, but in order for the CORS headers to exchange we need to make a first GET request to \"/hi\" which will not return anything\n\n    const store = this.props.store;\n    const addr = store.pathIndexServerAddress;\n    const path_name = store.pathNucPos.path;\n    const nuc_pos = store.pathNucPos.nucPos;\n\n    function handleOdgiServerResponse(result) {\n      if (result === \"0\") {\n        alert(\n          \"The jump query returned 0. Either your path does not exist or your position in the path is wrong. Please try again.\"\n        );\n      } else {\n        console.log(result);\n        // go from nucleotide position to bin\n        result = parseInt(result);\n        const newBeginBin = Math.ceil(result / store.getBinWidth());\n        console.log(newBeginBin);\n        store.updateBeginEndBin(newBeginBin, store.getEndBin());\n      }\n    }\n    // httpGetAsync(addr + \"hi\", printResult);\n    // httpGetAsync(addr + \"5/1\", printResult);\n    // httpGetAsync(addr + \"4/3\", printResult);\n    httpGetAsync(addr + path_name + \"/\" + nuc_pos, handleOdgiServerResponse);\n  }\n\n  change_zoom_level(target) {\n    console.log(\n      \"change_zoom_level: \" +\n        target.value +\n        \" ---\" +\n        target.options[target.selectedIndex].text\n    );\n\n    this.props.store.setIndexSelectedZoomLevel(parseInt(target.value));\n  }\n\n  decIndexSelectedZoomLevel() {\n    let indexSelZoomLevel = this.props.store.indexSelectedZoomLevel;\n    if (indexSelZoomLevel > 0) {\n      this.props.store.setIndexSelectedZoomLevel(indexSelZoomLevel - 1);\n    }\n  }\n\n  incIndexSelectedZoomLevel() {\n    let indexSelZoomLevel = this.props.store.indexSelectedZoomLevel;\n    if (indexSelZoomLevel < this.props.store.availableZoomLevels.length - 1) {\n      this.props.store.setIndexSelectedZoomLevel(indexSelZoomLevel + 1);\n    }\n  }\n\n  render() {\n    let showJumpPath = true; // TODO: unlock once the data is there\n    let pathRow = null;\n    if (showJumpPath) {\n      pathRow = (\n        <div className={\"row\"}>\n          Jump to path at nucleotide position:\n          <input\n            type=\"string\"\n            list=\"path\"\n            placeholder={\"path\"}\n            onChange={(event) =>\n              this.props.store.updatePathNucPos(\n                event.target.value,\n                this.props.store.pathNucPos.nucPos\n              )\n            }\n            style={{ width: \"80px\" }}\n          />\n          <datalist id=\"path\">\n            {this.props.schematic.pathNames.map((item, key) => (\n              <option key={key} value={item} />\n            ))}\n          </datalist>\n          -\n          <input\n            type=\"number\"\n            placeholder={\"position\"}\n            onChange={(event) =>\n              this.props.store.updatePathNucPos(\n                this.props.store.pathNucPos.path,\n                event.target.value\n              )\n            }\n            style={{ width: \"80px\" }}\n          />\n          <span style={{ marginLeft: \"2px\" }}>\n            <button className=\"button\" onClick={() => this.handleJump()}>\n              Jump\n            </button>\n          </span>\n        </div>\n      );\n    }\n\n    return (\n      <div id=\"button-container\">\n        {/*<button className=\"button\" id=\"btn-download\">*/}\n        {/*  Save Image*/}\n        {/*</button>*/}\n        <input\n          type=\"text\"\n          defaultValue={this.props.store.jsonName}\n          style={{ width: \"330px\" }}\n          onChange={this.props.store.tryJSONpath}\n          title={\"File:\"}\n        />\n        <span style={{ marginLeft: \"30px\" }}>\n          <Observer>\n            {() => (\n              <>\n                Bin width:\n                <button\n                  className=\"button\"\n                  onClick={() => this.decIndexSelectedZoomLevel()}\n                >\n                  -\n                </button>\n                <select\n                  id=\"select_bin_width\"\n                  onChange={(val) => this.change_zoom_level(val.target)}\n                  value={this.props.store.indexSelectedZoomLevel}\n                >\n                  {this.props.store.availableZoomLevels.map((item, i) => (\n                    <option key={i} value={i}>\n                      {item}\n                    </option>\n                  ))}\n                </select>\n                <button\n                  className=\"button\"\n                  onClick={() => this.incIndexSelectedZoomLevel()}\n                >\n                  +\n                </button>\n              </>\n            )}\n          </Observer>\n        </span>\n\n        <span style={{ marginLeft: \"30px\" }}>\n          <button className=\"button\" onClick={() => this.shift(-100)}>\n            &lt;&lt;\n          </button>\n          <button className=\"button\" onClick={() => this.shift(-50)}>\n            &lt;\n          </button>\n          Pangenome Bin Position:\n          <Observer>\n            {() => (\n              <>\n                <input\n                  type=\"number\"\n                  value={this.props.store.beginEndBin[0]} // TODO Get methods don't work here, but I don't know why. Need to ask Robert Buels.\n                  onChange={(event) =>\n                    this.props.store.updateBeginEndBin(\n                      event.target.value,\n                      this.props.store.getEndBin()\n                    )\n                  }\n                  style={{ width: \"80px\" }}\n                />\n                -\n                <input\n                  type=\"number\"\n                  value={this.props.store.beginEndBin[1]}\n                  readOnly\n                  style={{ width: \"80px\" }}\n                />\n              </>\n            )}\n          </Observer>\n          <button className=\"button\" onClick={() => this.shift(50)}>\n            &gt;\n          </button>\n          <button className=\"button\" onClick={() => this.shift(100)}>\n            &gt;&gt;\n          </button>\n        </span>\n        <div className={\"row\"}>\n          Jump to path at nucleotide position:\n          <span className=\"myarrow\">\n            <input\n              type=\"string\"\n              list=\"path\"\n              name=\"path\"\n              placeholder={\"path\"}\n              id=\"#show-suggestions\"\n              onChange={(event) =>\n                this.props.store.updatePathNucPos(\n                  event.target.value,\n                  this.props.store.pathNucPos.nucPos\n                )\n              }\n              style={{ width: \"80px\" }}\n            />\n          </span>\n          <datalist id=\"path\">\n            {this.props.schematic.pathNames.map((item, key) => (\n              <option key={key} value={item} />\n            ))}\n          </datalist>\n          -\n          <input\n            type=\"number\"\n            placeholder={\"position\"}\n            onChange={(event) =>\n              this.props.store.updatePathNucPos(\n                this.props.store.pathNucPos.path,\n                event.target.value\n              )\n            }\n            style={{ width: \"80px\" }}\n          />\n          <span style={{ marginLeft: \"2px\" }}>\n            <button className=\"button\" onClick={() => this.handleJump()}>\n              Jump\n            </button>\n          </span>\n          <span style={{ marginLeft: \"30px\" }}>\n            Pangenome Last Bin: {this.props.store.last_bin_pangenome}\n          </span>\n          <span style={{ marginLeft: \"30px\" }}>\n            Num. of individuals: {this.props.schematic.pathNames.length - 11}\n          </span>\n        </div>\n        <div className={\"row\"}>\n          <span>\n            {\" \"}\n            Allele Frequency Histogram:\n            <VerticalCompressedViewSwitch store={this.props.store} />\n          </span>\n          <span>\n            {\" \"}\n            Show Only Rearrangements:\n            <WidthCompressedViewSwitch store={this.props.store} />\n          </span>\n          {this.props.store.useWidthCompression ? (\n            <React.Fragment>\n              <span>\n                {\" \"}\n                Render Connectors:\n                <RenderConnectorSwitch store={this.props.store} />\n              </span>\n            </React.Fragment>\n          ) : (\n            <></>\n            /*\n              // At the moment the gene annotation will be always displayed if present\n              <span>\n                {\" \"}\n                    Display gene annotations:\n                <Observer>\n                  {() => <ColorGeoSwitch store={this.props.store} />}\n                </Observer>\n              </span>\n              */\n          )}\n          <span>\n            {\" \"}\n            Row Height:\n            <Observer>\n              {() => (\n                <input\n                  type=\"number\"\n                  min={1}\n                  value={this.props.store.pixelsPerRow}\n                  onChange={this.props.store.updateHeight}\n                  style={{ width: \"30px\" }}\n                />\n              )}\n            </Observer>\n          </span>\n          <span>\n            {\" \"}\n            Column Width:\n            <input\n              type=\"number\"\n              min={1}\n              value={this.props.store.pixelsPerColumn}\n              onChange={this.props.store.updateWidth}\n              style={{ width: \"30px\" }}\n            />\n          </span>\n          <span>\n            &nbsp;\n            <a\n              href={\"https://github.com/graph-genome/Schematize/wiki\"}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <strong>Pantograph Tutorial</strong>\n            </a>\n          </span>\n          <span>\n            &nbsp; &nbsp; &nbsp;\n            <a\n              href={\"http://covid-19.genenetwork.org/\"}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <strong>Source Dataset</strong>\n            </a>\n          </span>\n        </div>\n      </div>\n    );\n  }\n}\n\nControlHeader.propTypes = {\n  store: PropTypes.object,\n};\n\nclass VerticalCompressedViewSwitch extends React.Component {\n  render() {\n    return (\n      <Observer>\n        {() => (\n          <input\n            type=\"checkbox\"\n            checked={this.props.store.useVerticalCompression}\n            onChange={this.props.store.toggleUseVerticalCompression}\n          />\n        )}\n      </Observer>\n    );\n  }\n}\n\nVerticalCompressedViewSwitch.propTypes = {\n  store: PropTypes.object,\n};\n\nclass RenderConnectorSwitch extends React.Component {\n  render() {\n    return (\n      <Observer>\n        {() => (\n          <input\n            type=\"checkbox\"\n            checked={this.props.store.useConnector}\n            onChange={this.props.store.toggleUseConnector}\n          />\n        )}\n      </Observer>\n    );\n  }\n}\n\nRenderConnectorSwitch.propTypes = {\n  store: PropTypes.object,\n};\n\nclass WidthCompressedViewSwitch extends React.Component {\n  render() {\n    return (\n      <Observer>\n        {() => (\n          <input\n            type=\"checkbox\"\n            checked={this.props.store.useWidthCompression}\n            onChange={this.props.store.toggleUseWidthCompression}\n          />\n        )}\n      </Observer>\n    );\n  }\n}\n\nWidthCompressedViewSwitch.propTypes = {\n  store: PropTypes.object,\n};\n\nexport default ControlHeader;\n\n/*class ColorGeoSwitch extends React.Component {\n  render() {\n    return (\n        <input\n          type=\"checkbox\"\n          checked={this.props.store.colorByGeo}\n          onChange={this.props.store.toggleColorByGeo}\n        />\n    );\n  }\n}\n\nColorGeoSwitch.propTypes = {\n  store: PropTypes.object,\n};*/\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import { types } from \"mobx-state-tree\";\nimport { urlExists } from \"./URL\";\nimport { arraysEqual, checkAndForceMinOrMaxValue, isInt } from \"./utilities\";\n\nconst Chunk = types.model({\n  file: types.string,\n  fasta: types.maybeNull(types.string),\n  first_bin: types.integer,\n  last_bin: types.integer,\n  x: types.integer,\n  compressedX: types.integer,\n});\nconst ZoomLevel = types.model({\n  bin_width: types.integer,\n  last_bin: types.integer,\n  files: types.array(Chunk),\n});\nconst ChunkIndex = types.maybeNull(\n  types.model({\n    json_version: 14,\n    pangenome_length: types.integer,\n    zoom_levels: types.map(ZoomLevel),\n  })\n);\nconst PathNucPos = types.model(\"PathNucPos\", {\n  path: types.string,\n  nucPos: types.integer,\n});\n\nconst metaDataModelEntry = types.model({\n  Path: types.identifier,\n  Color: types.string,\n  Info: types.string,\n});\n\nlet RootStore;\nRootStore = types\n  .model({\n    chunkIndex: ChunkIndex,\n    beginEndBin: types.optional(types.array(types.integer), [1, 100]),\n    useVerticalCompression: false,\n    useWidthCompression: false,\n    binScalingFactor: 3,\n    useConnector: true,\n    pixelsPerColumn: 10,\n    pixelsPerRow: 3,\n    heightNavigationBar: 25,\n    leftOffset: 1,\n    topOffset: 400,\n    highlightedLink: 0, // we will compare linkColumns\n    maximumHeightThisFrame: 150,\n    cellToolTipContent: \"\",\n    jsonName: \"SARS-CoV-2\",\n    // Added attributes for the zoom level management\n    availableZoomLevels: types.optional(types.array(types.string), [\"1\"]),\n\n    precIndexSelectedZoomLevel: 0,\n    indexSelectedZoomLevel: 0,\n\n    chunkURLs: types.optional(types.array(types.string), []),\n    chunkFastaURLs: types.optional(types.array(types.string), []),\n    //to be compared against chunkURLs\n    chunksProcessed: types.optional(types.array(types.string), []),\n    chunksProcessedFasta: types.optional(types.array(types.string), []),\n\n    pathNucPos: types.optional(PathNucPos, { path: \"path\", nucPos: 0 }), // OR: types.maybe(PathNucPos)\n    pathIndexServerAddress: \"https://pantograph.lugli.arvadosapi.com/\",\n\n    loading: true,\n    copyNumberColorArray: types.optional(types.array(types.string), [\n      \"#6a6a6a\",\n      \"#5f5f5f\",\n      \"#545454\",\n      \"#4a4a4a\",\n      \"#3f3f3f\",\n      \"#353535\",\n      \"#2a2a2a\",\n      \"#1f1f1f\",\n      \"#151515\",\n      \"#0a0a0a\",\n      \"#000000\",\n    ]),\n    invertedColorArray: types.optional(types.array(types.string), [\n      \"#de4b39\",\n      \"#c74333\",\n      \"#b13c2d\",\n      \"#9b3427\",\n      \"#852d22\",\n      \"#6f251c\",\n      \"#581e16\",\n      \"#421611\",\n      \"#2c0f0b\",\n      \"#160705\",\n      \"#000000\",\n    ]),\n\n    last_bin_pangenome: 0,\n\n    colorByGeneAnnotation: true,\n    metaDataKey: \"Path\",\n    metaData: types.map(metaDataModelEntry),\n    //metaDataChoices: types.array(types.string)\n  })\n  .actions((self) => {\n    function setChunkIndex(json) {\n      console.log(\"STEP #2: chunkIndex contents loaded\");\n      //console.log(\"Index updated with content:\", json);\n\n      self.chunkIndex = null; // TODO: TEMPORARY HACK before understanding more in depth mobx-state or change approach\n\n      self.chunkIndex = json;\n    }\n    function updateBeginEndBin(newBegin, newEnd) {\n      /*This method needs to be atomic to avoid spurious updates and out of date validation.*/\n\n      console.log(\"updateBeginEndBin - \" + newBegin + \" - \" + newEnd);\n\n      // Sometimes, typing new bin, it arrives something that is not a valid integer\n      if (!isInt(newBegin) || !isInt(newEnd)) {\n        newBegin = 1;\n        newEnd = 100;\n      }\n\n      // TODO: manage a maxBeginBin based on the width of the last components in the pangenome\n      newBegin = Math.min(\n        self.last_bin_pangenome - 1,\n        Math.max(1, Math.round(newBegin))\n      );\n\n      setBeginEndBin(newBegin, newEnd);\n    }\n    function updateTopOffset(newTopOffset) {\n      if (Number.isFinite(newTopOffset) && Number.isSafeInteger(newTopOffset)) {\n        self.topOffset = newTopOffset + 10;\n      }\n    }\n    function updateBinScalingFactor(event) {\n      let newFactor = event.target.value;\n      self.binScalingFactor = Math.max(1, Number(newFactor));\n    }\n    function updateHighlightedLink(linkRect) {\n      self.highlightedLink = linkRect;\n    }\n    function updateMaxHeight(latestHeight) {\n      self.maximumHeightThisFrame = Math.max(\n        self.maximumHeightThisFrame,\n        latestHeight\n      );\n    }\n    function resetRenderStats() {\n      self.maximumHeightThisFrame = 1;\n    }\n    function updateCellTooltipContent(newContents) {\n      self.cellToolTipContent = String(newContents);\n    }\n    function toggleUseVerticalCompression() {\n      self.useVerticalCompression = !self.useVerticalCompression;\n    }\n    function toggleUseWidthCompression() {\n      self.useWidthCompression = !self.useWidthCompression;\n    }\n    function toggleUseConnector() {\n      self.useConnector = !self.useConnector;\n    }\n    function updateHeight(event) {\n      self.pixelsPerRow = checkAndForceMinOrMaxValue(\n        Number(event.target.value),\n        1,\n        30\n      );\n    }\n    function updateWidth(event) {\n      self.pixelsPerColumn = checkAndForceMinOrMaxValue(\n        Number(event.target.value),\n        3,\n        30\n      );\n    }\n\n    function tryJSONpath(event) {\n      const url =\n        process.env.REACT_APP_FETCH + event.target.value + \"/bin2file.json\";\n      if (urlExists(url)) {\n        console.log(\"STEP#1: New Data Source: \" + event.target.value);\n        self.jsonName = event.target.value;\n      }\n    }\n\n    // Lifted down the control of the emptyness of the arrays\n    function switchChunkURLs(arrayOfFile) {\n      if (!arraysEqual(arrayOfFile, self.chunkURLs)) {\n        console.log(\"STEP #4: Set switchChunkURLs: \" + arrayOfFile);\n        self.chunkURLs = arrayOfFile;\n\n        self.chunksProcessed = []; // Clear\n\n        return true;\n      }\n      return false;\n    }\n    function switchChunkFastaURLs(arrayOfFile) {\n      if (!arraysEqual(arrayOfFile, self.chunkFastaURLs)) {\n        console.log(\"STEP #4.fasta: Set switchChunkFastaURLs: \" + arrayOfFile);\n        self.chunkFastaURLs = arrayOfFile;\n\n        self.chunksProcessedFasta = []; // Clear\n      }\n    }\n    function addChunkProcessed(singleChunk) {\n      console.log(\"STEP #7: processed \" + singleChunk);\n      self.chunksProcessed.push(singleChunk);\n    }\n    function addChunkProcessedFasta(singleChunkFasta) {\n      console.log(\"STEP #7.FASTA: processed \" + singleChunkFasta);\n      self.chunksProcessedFasta.push(singleChunkFasta);\n    }\n    function getBeginBin() {\n      return self.beginEndBin[0];\n    }\n    function getEndBin() {\n      return self.beginEndBin[1];\n    }\n\n    // Getter and setter for zoom info management\n    function getBinWidth() {\n      //Zoom level and BinWidth are actually the same thing\n      return Number(self.getSelectedZoomLevel());\n    }\n    function getSelectedZoomLevel(get_prec_zoom_level = false) {\n      //This is a genuinely useful getter\n      let a =\n        self.availableZoomLevels[\n          get_prec_zoom_level\n            ? self.precIndexSelectedZoomLevel\n            : self.indexSelectedZoomLevel\n        ];\n\n      // Clear precIndexSelectedZoomLevel (it is usable only one time)\n      if (get_prec_zoom_level) {\n        self.precIndexSelectedZoomLevel = self.indexSelectedZoomLevel;\n      }\n\n      return a ? a : \"1\";\n    }\n    function setIndexSelectedZoomLevel(index) {\n      self.precIndexSelectedZoomLevel = self.indexSelectedZoomLevel;\n      self.indexSelectedZoomLevel = index;\n    }\n\n    function setAvailableZoomLevels(availableZoomLevels) {\n      let arr = [...availableZoomLevels];\n\n      self.availableZoomLevels = arr;\n    }\n\n    function setBeginEndBin(newBeginBin, newEndBin) {\n      self.beginEndBin = [newBeginBin, newEndBin];\n    }\n    function updatePathNucPos(path, nucPos) {\n      //console.log('updatePathNucPos: ' + path + ' --- ' + nucPos)\n\n      if (path !== undefined) {\n        if (nucPos) {\n          nucPos = Math.abs(parseInt(nucPos));\n        } else {\n          nucPos = 0;\n        }\n        self.pathNucPos = { path: path, nucPos: nucPos };\n      }\n    }\n\n    function setLoading(val) {\n      self.loading = val;\n    }\n    function setLastBinPangenome(val) {\n      self.last_bin_pangenome = val;\n    }\n\n    /*function toggleColorByGeo() {\n      self.colorByGeo = !self.colorByGeo;\n    }*/\n    function setMetaData(metadata) {\n      for (let [key, value] of Object.entries(metadata)) {\n        self.metaData.set(key, value);\n      }\n    }\n    function getMetaData(key) {\n      self.metaData.get(key);\n    }\n    function setMetaDataChoices(ar) {\n      self.metaDataChoices = ar;\n    }\n\n    return {\n      setChunkIndex,\n      updateBeginEndBin,\n      updateTopOffset,\n      updateHighlightedLink,\n      updateMaxHeight,\n      resetRenderStats,\n      updateCellTooltipContent,\n      updateBinScalingFactor,\n      toggleUseVerticalCompression,\n      toggleUseWidthCompression,\n      toggleUseConnector,\n      updateHeight,\n      updateWidth,\n      tryJSONpath,\n\n      switchChunkURLs,\n      switchChunkFastaURLs,\n      addChunkProcessed,\n      addChunkProcessedFasta,\n\n      getBeginBin,\n      getEndBin,\n      updatePathNucPos,\n\n      //NOTE: DO NOT ADD GETTERS here.  They are not necessary in mobx.\n      // You can reference store.val directly without store.getVal()\n      //Only write getters to encapsulate useful logic for derived values\n\n      // Added zoom actions\n      getBinWidth,\n      getSelectedZoomLevel,\n      setIndexSelectedZoomLevel,\n      setAvailableZoomLevels,\n\n      setLoading,\n\n      setLastBinPangenome,\n\n      //toggleColorByGeo,\n      setMetaData,\n      getMetaData,\n      setMetaDataChoices,\n    };\n  })\n  .views((self) => ({}));\n\nexport const store = RootStore.create({});\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport { store } from \"./ViewportInputsStore\";\n\nReactDOM.render(<App store={store} />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}